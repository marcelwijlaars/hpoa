<!--    (C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/batchManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript" src="../js/domBuilder.js"></script>
<script type="text/javascript" src="../js/ebipav6.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
var BLADE_EVENT_MP=0;
var BLADE_EVENT_INFO=1;
function loadContent(){
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
<!--Add EVENT_BLADE_FQDN_INFO_REFRESH to the handler of BLADE_MP_INFO,in case of adding FQDN to this page in the future-->
hpem.registerEventHandler(function(result){updateDeviceList(result,BLADE_EVENT_MP);},['EVENT_BLADE_MP_INFO','EVENT_ILO_HAS_IPV6ADDRESS','EVENT_VLAN_INFO_CHANGED']);
hpem.registerEventHandler(function(result){updateDeviceList(result,BLADE_EVENT_INFO);},['EVENT_BLADE_INFO','EVENT_BAY_CHANGED']);
<!--Add EVENT_TRAY_FQDN_INFO_REFRESH to the handler of INTERCONNECT_INFO,in case of adding FQDN to this page in the future-->
hpem.registerEventHandler(updateInterconnectList,['EVENT_INTERCONNECT_INFO','EVENT_TRAY_FQDN_INFO_REFRESH']);
ourTabManager.toggleTabs('ebipav6Server');
setTabContent('ebipav6Server');
}
else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}
function setTabContent(tabId){
var tab=document.getElementById(tabId);
if(tab){
var contentLocation=tab.getAttribute('contentLocation');
var contextId=tab.getAttribute('contextId');
if(contentLocation){
var formMgrDev=new FormManager(function(success){
var formMgr=new FormManager(function(success){
var side=0;
var ebipav6InfoDoc=formMgr.getDataByCallIndex(0);
if(tabId.indexOf('ebipav6Server1')>-1){
side=1;
}
else if(tabId.indexOf('ebipav6Server2')>-1){
side=2;
}
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('ebipav6InfoDoc',ebipav6InfoDoc);
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
if(tabId.indexOf('ebipav6Server')>-1){
processor.addParameter('side',side);
}
document.getElementById('tabContent').innerHTML=processor.getOutput();
if(tabId.indexOf('ebipav6Server')>-1){
transformDevicev6List([hpem],[side],hpem.getUserAccessLevel());
}
else{
transformInterconnectv6List([hpem],hpem.getUserAccessLevel());
}
reconcilePage();
},false,'','tabContent');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getBladeMpInfoAll);
formMgr.queueCall(hpem.getVlanInfo);
formMgr.endBatch();
top.mainPage.getHelpLauncher().setCurrentTopic(contextId);
},false,'','tabContent');
formMgrDev.startBatch(true,(hpem.getActiveFirmwareVersion()<4.20));
if(hpem.getActiveFirmwareVersion()>=4.20){
formMgrDev.queueCall(hpem.getEbipav6InfoEx);
}else{
formMgrDev.queueCall(hpem.getEbipav6Info);
}
formMgrDev.endBatch();
}
}
else{
displayContentFailed('tabContent',[top.getString('problemSelectTab')]);
}
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function updateDeviceList(result,eventType){
var bayNumber=getElementValueXpath(result,'//hpoa:bayNumber');
if(isNaN(parseInt(bayNumber))){
return;
}
if(eventType==BLADE_EVENT_MP){
var mpInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'server'+bayNumber+'MpAddress');
if(mpInfoSpan){
var currentAddress=getDevicev6BayCurrentIPv6Address(result);
mpInfoSpan.innerHTML=currentAddress;
}
}
else if(eventType==BLADE_EVENT_INFO){
var bladeInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'server'+bayNumber+'DeviceType');
if(bladeInfoSpan){
var deviceType=getElementValueXpath(result,'//hpoa:bladeType');
var presence=getElementValueXpath(result,'//hpoa:presence');
var deviceText='';
if(presence=='ABSENT'){
deviceText=top.getString('statusAbsent');
}
else if(presence=='SUBSUMED'){
deviceText=top.getString('subsumed');
}
else{
if(deviceType=='BLADE_TYPE_SERVER'){
deviceText=top.getString('serverBlade');
}
else if(deviceType=='BLADE_TYPE_STORAGE'){
deviceText=top.getString('storageBlade');
}
else if(deviceType=='BLADE_TYPE_IO'){
deviceText=top.getString('ioBlade');
}
else{
deviceText=top.getString('statusUnknown');
}
}
bladeInfoSpan.innerHTML=deviceText;
}
}
}
function updateInterconnectList(result){
var bayNumber=getElementValueXpath(result,'//hpoa:bayNumber');
var mpInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'interconnect'+bayNumber+'MpAddress');
var ioInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'interconnect'+bayNumber+'DeviceType');
if(ioInfoSpan){
var ioStatusDoc=hpem.getInterconnectTrayStatus(bayNumber,null,false);
var presence=getElementValueXpath(ioStatusDoc,'//hpoa:presence');
var presenceText=top.getString('statusUnknown');
if(presence=='PRESENT'){
var ioType=getElementValueXpath(result,'//hpoa:interconnectTrayType');
var extendedIoType=getElementValueXpath(result,'//hpoa:extraData[@hpoa:name="ExtendedFabricType"]');
if(extendedIoType!=""){
presenceText=extendedIoType;
}
else{
switch(ioType){
case 'INTERCONNECT_TRAY_TYPE_NIC':
presenceText='Ethernet';
break;
case 'INTERCONNECT_TRAY_TYPE_FC':
presenceText='Fiber Channel';
break;
case 'INTERCONNECT_TRAY_TYPE_SAS':
presenceText='SAS';
break;
case 'INTERCONNECT_TRAY_TYPE_IB':
presenceText='Infiniband';
break;
case 'INTERCONNECT_TRAY_TYPE_PCIE':
presenceText='PCIE';
break;
case 'INTERCONNECT_TRAY_TYPE_MAX':
presenceText='MAX';
break;
case 'INTERCONNECT_TRAY_TYPE_NO_CONNECTION':
presenceText=top.getString('noConnection');
break;
default:
presenceText=top.getString('statusUnknown');
}
}
}
else if(presence=='SUBSUMED'){
presenceText=top.getString('subsumed');
}
else if(presence=='ABSENT'){
presenceText=top.getString('statusAbsent');
}
ioInfoSpan.innerHTML=presenceText;
}
if(mpInfoSpan){
var inbandIpv6=getInterconnectv6BayCurrentAddress(result);
mpInfoSpan.innerHTML=inbandIpv6;
}
}
function setupEbipav6(bayType,side){
var waitPhrase=top.getString('completingEBIPAv6Setting');
var waitDescription=top.getString('setupEbipav6');
var bayPrefix='';
var errorID='';
var ebipav6Config=null;
var ebipav6NetProtocol;
var confirmMsg='';
if(bayType=='SERVER_BLADE_BAY'){
bayPrefix='svb';
errorID='serverErrorDisplay';
ebipav6NetProtocol=NET_PROTO_EBIPAV6_SVB();
waitDescription+=top.getString('setupEbipav6Dev');
confirmMsg=top.getString('saveEBIPAv6SettingDesc');
confirmMsg+=top.getString('areYouSureProceed');
}
else if(bayType=='INTERCONNECT_TRAY_BAY'){
bayPrefix='swm';
errorID='interconnectErrorDisplay';
ebipav6NetProtocol=NET_PROTO_EBIPAV6_SWM();
if(!checkRangeValidInterconnectv6()){
alert(top.getString('ebipav6InterconnectRangeInvalid'));
return;
}
waitDescription+=top.getString('setupEbipav6Int');
confirmMsg=top.getString('noteEbipav6EnabledBaysAddr');
confirmMsg+=top.getString('areYouSureProceed');
}
if(confirm(confirmMsg)){
ebipav6Config=getEbipav6Config(hpem,hpem.getUuid());
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor('../Templates/ebipav6Errors.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('errorsDoc',formMgr.getDataByCallIndex(0));
var errorContainer=document.getElementById(errorID);
errorContainer.innerHTML=processor.getOutput();
errorContainer.style.display='block';
}
},false,errorID,'tabContent');
formMgr.createWaitContainer(waitPhrase,waitDescription);
formMgr.startBatch();
if(hpem.getActiveFirmwareVersion()>=4.20){
formMgr.queueCall(hpem.setEbipav6InfoEx,[ebipav6Config]);
}else{
formMgr.queueCall(hpem.setEbipav6Info,[ebipav6Config]);
}
formMgr.endBatch();
}
}
function unloadHandlers(){
try{
hpem.removeRegisteredHandler(updateInterconnectList);
}
catch(e){}
}
    </script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="unloadHandlers();">

    <b><script type="text/javascript">document.write(top.getString('ebipav6Long'));</script></b><br />
    <span class="whiteSpacer">&#160;</span><br />

    <table cellpadding="0" cellspacing="0" border="0" width="100%">
      <tr>
        <td valign="bottom">
          <div class="tabSet" id="tabSet">
            <div class="tabOff" tabid="ebipav6Server" contextId="FORM_SVB_EBIPAV6_SETTINGS" id="ebipav6Server" contentLocation="../Forms/Ebipav6Server.xsl"><script type="text/javascript">document.write(top.getString('serverBays'));</script></div>
            <div class="tabOff" tabid="ebipav6Server1" contextId="FORM_SVB_EBIPAV6_SIDE_A_SETTINGS" id="ebipav6Server1" contentLocation="../Forms/Ebipav6Server.xsl"><script type="text/javascript">document.write(top.getString('serverBayDblDenseSideA'));</script></div>
            <div class="tabOff" tabid="ebipav6Server2" contextId="FORM_SVB_EBIPAV6_SIDE_B_SETTINGS" id="ebipav6Server2" contentLocation="../Forms/Ebipav6Server.xsl"><script type="text/javascript">document.write(top.getString('serverBayDblDenseSideB'));</script></div>
            <div class="tabOff" tabid="ebipav6Interconnect" contextId="FORM_SWM_EBIPAV6_SETTINGS" id="ebipav6Interconnect" contentLocation="../Forms/Ebipav6Interconnect.xsl"><script type="text/javascript">document.write(top.getString('interconnectBays'));</script></div>
            <div class="tabBottomLine"></div>
          </div>
        </td>
      </tr>
      <tr>
        <td style="padding-top:10px;">
          <div id="tabContent"></div>
        </td>
      </tr>
    </table>

    <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
    </script>

    <div id="waitContainer"></div>
</body>
</html>
