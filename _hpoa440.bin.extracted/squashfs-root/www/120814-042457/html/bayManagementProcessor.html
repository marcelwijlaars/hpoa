<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css"/>
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css"/>
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css"/>
<link rel="stylesheet" type="text/css" href="../Help/stylesheets/help.css"/>
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/tableManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/helpTips.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript" src="../js/iLO.js"></script>

<script type="text/javascript">
var encNum;
var bayNum;
var hpem=null;
var mpInfoDoc=null;
var logContent=null;
var bayContext="";
var sortField='LAST_UPDATE';
var sortOrder='ASC';
var xml=top.getXml();
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function loadContent(){
try{
bayNum=parseInt(getSearchValue(location.search,'bayNum'));
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(bayNum)&&!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
var bladeInfo=hpem.getBladeInfo(bayNum);
var bladeType=getElementValueXpath(bladeInfo,'//hpoa:bladeType')
var productId=parseInt(getElementValueXpath(bladeInfo,'//hpoa:productId'));
if(productId==0x2020){
document.getElementById('tabSet').style.display='block';
}
if(bladeType=="BLADE_TYPE_IO"){
bayContext="_IO";
}
hpem.registerEventHandler(mpInfoLoaded,['EVENT_BLADE_MP_INFO','EVENT_ILO_HAS_IPADDRESS','EVENT_VLAN_INFO_CHANGED','EVENT_BLADE_FQDN_INFO_REFRESH']);
ourTabManager.toggleTabs('mpInfo');
setTabContent('mpInfo');
}
}
catch(e){}
}
function setTabContent(tabId,fresh){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextHelpId=contentTab.getAttribute('contextId')+bayContext;
if(contentLocation){
try{
if(hpem!=null){
switch(tabId){
case 'mpInfo':
var formMgr=new FormManager(function(success){
if(success){
mpInfoLoaded(formMgr.getDataByCallIndex(0));
}else{
if(false){
var errString='The iLO in this bay cannot communicate with the default gateway. ';
errString+='Please fix this problem before attempting to access this iLO\'s information.';
displayContentFailed('tabContent',[errString]);
}
else{
displayContentFailed('tabContent',formMgr.getErrorsArray());
}
}
},true,'','tabContent');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getBladeMpInfo,[bayNum]);
formMgr.queueCall(hpem.getVlanInfo);
formMgr.endBatch();
break;
case 'mpEventLog':
if(typeof(fresh)=='undefined'){
var fresh=true;
}
var eventLogLoaded=function(success){
if(success){
if(fresh||logContent==null){
var logText=getElementValueFromString(formMgr.getDataByCallIndex(0).xml,'hpoa:logContents');
logContent=xml.parseXML(logText);
}
var processor=new XsltProcessor('../Templates/iLoLogs.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('logDoc',logContent);
processor.addParameter('sortOrder',sortOrder);
processor.addParameter('sortField',sortField);
document.getElementById('tabContent').innerHTML=processor.getOutput();
reconcilePage();
}
else{
try{
displayContentFailed('tabContent',formMgr.getErrorsArray());
}
catch(e){
}
}
};
if(fresh||logContent==null){
var formMgr=new FormManager(eventLogLoaded,true,'','tabContent');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getBladeMpEventLog,[bayNum]);
formMgr.endBatch();
}else{
eventLogLoaded(true);
}
break;
default:
displayContentFailed('tabContent',['Invalid tab']);
break;
}
top.mainPage.getHelpLauncher().setCurrentTopic(contextHelpId);
}else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
}
function mpInfoLoaded(result){
var bayNumber=getElementValueXpath(result,'//hpoa:bayNumber');
var vlanIdForThisBay=getElementValueXpath(result,"//hpoa:vlanInfo/hpoa:portArray/hpoa:port[position() ="+bayNum+"]/hpoa:portId");
var bladeInfo=hpem.getBladeInfo(bayNum);
var presence='';
if(bladeInfo!=null){
presence=getElementValueXpath(bladeInfo,'//hpoa:bladeInfo/hpoa:presence');
}
if(bayNumber==bayNum){
if(presence=='PRESENT'){
if(getCurrentTab()=='mpInfo'){
mpInfoDoc=result;
var processor=new XsltProcessor('../Templates/bayManagementProcessor.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('mpInfoDoc',mpInfoDoc);
processor.addParameter('bladeInfoDoc',hpem.getBladeInfo(bayNum));
processor.addParameter('vlanInfoDoc',hpem.getVlanInfo());
document.getElementById('tabContent').innerHTML=processor.getOutput();
var productId=parseInt(getElementValueXpath(bladeInfo,'//hpoa:productId'));
if(productId==0x2020){
document.getElementById('tabSet').style.display='block';
}
reconcilePage();
}
}
else{
document.getElementById('tabContent').innerHTML=top.getErrorString('181','USER_REQUEST');
document.getElementById('tabSet').style.display='none';
ourTabManager.toggleTabs('mpInfo');
}
}
}
function sortEventLog(field){
if(field==sortField){
sortOrder=(sortOrder=='ASC')?'DESC':'ASC';
}else{
sortField=field;
sortOrder='ASC';
}
setTabContent('mpEventLog',false);
}
function deRegisterEventHandlers(){
if(hpem!=null){
hpem.removeRegisteredHandler(mpInfoLoaded);
}
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="deRegisterEventHandlers();">	
	<div id="bodyContent">	
		<table cellpadding="0" cellspacing="0" border="0" width="100%">
			<tr>
				<td valign="bottom">
					<div class="tabSet" id="tabSet" style="display:none;">
						<div class="tabOff" tabid="mpInfo" contextId="FORM_SVB_PROC_INFO" id="mpInfo" contentLocation="../Templates/bayManagementProcessor.xsl"><script type="text/javascript">document.write(top.getString('processorInfo'));</script></div>
						<div class="tabOff" tabid="mpEventLog" contextId="FORM_SVB_EVENT_LOG" id="mpEventLog" contentLocation="../Templates/bayInfo.xsl"><script type="text/javascript">document.write(top.getString('eventLog'));</script></div>
						<div class="tabBottomLine"></div>
					</div>					
				</td>
			</tr>
			<tr>
				<td style="padding-top:10px;">
					<div id="tabContent"></div>
				</td>
			</tr>
		</table>		

    <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
    </script>

	</div>	
  <div id="iLoSsoContent"></div>
  <!-- required elements for popup tooltips -->
  <div id="tooltip" class="popupSmallWrapper">
    <div class="popupSmallTitle"><img alt="" src="/120814-042457/images/icons/help-popup.png" /></div>
    <div id="tooltipText" class="popupSmallBody"></div>
  </div>
</body>
</html>
