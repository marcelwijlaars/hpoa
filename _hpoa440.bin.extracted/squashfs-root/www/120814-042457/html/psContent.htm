<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title></title>
<link rel="stylesheet" type="text/css" href="../css/default.css"/>
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css"/>
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css"/>
<link rel="stylesheet" type="text/css" href="../css/widgets.css"/>
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

 <!--
	Include the init and xml javascript files from the jsolait library.
	The xslt.js file requires that these two files be included before it.
-->
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var psNum='';
var encNum='';
var hpem=null;
function loadContent(){
try{
psNum=parseInt(getSearchValue(location.search,'psNum'));
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(psNum)&&!isNaN(encNum)&&
(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
transformPage();
hpem.registerEventHandler(psChanged,['EVENT_PS_STATUS','EVENT_PS_INSERTED','EVENT_PS_INFO','EVENT_PS_REMOVED']);
hpem.registerEventHandler(psRemoved,['EVENT_PS_REMOVED']);
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_PS_INFO");
}
else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('bodyContent',[e.message]);
}
}
function transformPage(){
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor('../Templates/powerSupplyStatus.xsl');
processor.setSourceDocument(top.getStringsDoc());
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('powerSupplyStatusDoc',hpem.getPsStatus(psNum));
processor.addParameter('powerSupplyInfoDoc',hpem.getPsInfo(psNum));
processor.addParameter('powerConfigInfoDoc',hpem.getPowerConfigInfo());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
reconcilePage();
},false);
formMgr.makeCall(hpem.getPowerConfigInfo);
}
function psChanged(result){
var bayNumber=getElementValueXpath(result,'//hpoa:powerSupplyStatus/hpoa:bayNumber');
var presence=getElementValueXpath(result,'//hpoa:powerSupplyStatus/hpoa:presence');
if(bayNumber==psNum&&presence=='PRESENT'){
transformPage();
}
}
function psRemoved(result){
var bayNumber=getElementValueXpath(result,'//hpoa:powerSupplyStatus/hpoa:bayNumber');
if(bayNumber==psNum){
document.getElementById('bodyContent').innerHTML=top.getString('powerSupplyWasRemoved');
}
}
function deRegisterEventHandlers(){
hpem.removeRegisteredHandler(psChanged);
hpem.removeRegisteredHandler(psRemoved);
}
function refresh(){
var formMgr=new FormManager(function(success){
transformPage();
},false);
formMgr.startBatch(true,true);
formMgr.queueCall(hpem.getPsStatus,[psNum]);
formMgr.queueCall(hpem.getPsInfo,[psNum]);
formMgr.endBatch();
}
	</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="deRegisterEventHandlers();">
	<div id="bodyContent"></div>
</body>
</html>
