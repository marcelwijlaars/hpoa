<!--  (C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title></title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<link rel="stylesheet" type="text/css" href="../css/widgets.css">
<script src="../js/EnvironConstants.js" type="text/javascript"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
var ourInputValidator=null;
function pageLoad(){
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.getTopology().getProxy(encNum))!=null){
if(hpem.getUserAccessLevel()=='ADMINISTRATOR'){
document.getElementById('encComponentFirmware').style.display='block';
}
var statusEvents=[
'EVENT_ENC_STATUS',
'EVENT_ENC_UID',
'EVENT_ENC_SHUTDOWN',
'EVENT_BLADE_STATUS',
'EVENT_BLADE_UID',
'EVENT_BLADE_POWER_STATE',
'EVENT_BLADE_INSERTED',
'EVENT_BLADE_INSERT_COMPLETED',
'EVENT_BLADE_REMOVED',
'EVENT_BLADE_POWER_MGMT',
'EVENT_BLADE_SHUTDOWN',
'EVENT_BLADE_THERMAL',
'EVENT_BLADE_FAULT',
'EVENT_BLADE_CONNECT',
'EVENT_BLADE_DISCONNECT',
'EVENT_BLADE_GRP_CAP_TIMEOUT',
'EVENT_FAN_STATUS',
'EVENT_FAN_INSERTED',
'EVENT_FAN_REMOVED',
'EVENT_FAN_ZONE_STATUS',
'EVENT_INTERCONNECT_STATUS',
'EVENT_INTERCONNECT_UID',
'EVENT_INTERCONNECT_RESET',
'EVENT_INTERCONNECT_REMOVED',
'EVENT_INTERCONNECT_INSERTED',
'EVENT_SWITCH_CONNECT',
'EVENT_SWITCH_DISCONNECT',
'EVENT_INTERCONNECT_HEALTH_LED',
'EVENT_INTERCONNECT_THERMAL',
'EVENT_INTERCONNECT_CPUFAULT',
'EVENT_INTERCONNECT_POWER',
'EVENT_PS_STATUS',
'EVENT_PS_INSERTED',
'EVENT_PS_REMOVED',
'EVENT_PS_REDUNDANT',
'EVENT_PS_SUBSYSTEM_STATUS',
'EVENT_PS_OVERLOAD',
'EVENT_AC_FAILURE',
'EVENT_THERMAL_STATUS',
'EVENT_COOLING_STATUS',
'EVENT_OA_STATUS'
];
hpem.registerEventHandler(enclosureNameChanged,['EVENT_ENC_NAMES','EVENT_ENC_INFO']);
hpem.registerEventHandler(uidStateChangeHandler,['EVENT_ENC_UID']);
hpem.registerEventHandler(enclosureStatusChanged,statusEvents);
if(hpem.getUserOaPermission()&&hpem.getUserAccessLevel()!='USER'){
document.getElementById('encVirtualButtons').style.display='block';
}
}
}
catch(e){
top.logEvent("Enclosure Status: "+e.message,encNum,1,6);
}
selectTab('encStatus');
}
function selectTab(tabId){
ourTabManager.toggleTabs(tabId);
setTabContent(tabId);
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function setTabContent(tabId){
try{
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextHelpId=contentTab.getAttribute('contextId');
if(contentLocation){
if(!isNaN(encNum)&&hpem!=null){
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('enclosureInfoDoc',hpem.getEnclosureInfo());
processor.addParameter('enclosureStatusDoc',hpem.getEnclosureStatus());
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('serviceUserOaAccess',hpem.getUserOaPermission());
processor.addParameter('encNum',encNum);
processor.addParameter('enclosureType',hpem.getEnclosureType());
if(tabId=='encStatus'){
processor.addParameter('systemStatusDoc',top.mainPage.getHiddenFrame().getSystemStatusDocument(true));
processor.addParameter('oaStatusDoc',hpem.getOaStatusDOM());
processor.addParameter('powerSubsystemInfoDoc',hpem.getPowerSubsystemInfo());
processor.addParameter('thermalSubsystemInfoDoc',hpem.getThermalSubsystemInfo());
}else if(tabId=='encInfo'){
processor.addParameter('oaSessionKey',(hpem.getActiveFirmwareVersion()<2.00?hpem.getSessionKey():""));
processor.addParameter('oaUrl',removeTrailingSlash(getServiceUrl(hpem.getIsLocal()?'':hpem.getProxyUrl(),true)));
}else if(tabId=='encComponentFirmware'){
processor.addParameter('encComponentFirmware',hpem.getEnclosureComponentFirmware());
}
document.getElementById('bodyContent').innerHTML=processor.getOutput();
top.mainPage.getHelpLauncher().setCurrentTopic(contextHelpId);
},false);
formMgr.startBatch(true);
formMgr.queueCall(hpem.getEnclosureInfo);
formMgr.queueCall(hpem.getEnclosureStatus);
formMgr.queueCall(hpem.getOaStatusAll);
formMgr.queueCall(hpem.getPowerSubsystemInfo);
formMgr.queueCall(hpem.getEnclosureComponentFirmware);
formMgr.endBatch();
}else{
displayContentFailed('bodyContent',[top.getString("noOnboardAdmin")]);
}
}else{
displayContentFailed('bodyContent',['Could locate the content stylesheet.']);
}
}catch(e){
displayContentFailed('bodyContent',[e.message]);
}
reconcilePage();
}
function setupEnclosureInfo(){
ourInputValidator=new InputValidator(null,'errorDisplay',true);
if(ourInputValidator.allInputsValidate()){
var encName=document.getElementById('enclosureName').value;
var rackName=document.getElementById('rackName').value;
var assetTag=document.getElementById('assetTag').value;
var waitPhrase=top.getString('completingEnclosureSettings');
var formMgr=new FormManager();
formMgr.createWaitContainer(waitPhrase);
with(formMgr){
startBatch();
queueCall(hpem.setEnclosureName,[encName],['enclosureNameLabel']);
queueCall(hpem.setRackName,[rackName],['rackNameLabel'],['200']);
queueCall(hpem.setEnclosureAssetTag,[assetTag],['assetTagLabel']);
endBatch();
}
}else{
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
}
}
function setUidState(state){
hpem.setEnclosureUid(state,function(){});
}
function uidStateChangeHandler(result){
if(getCurrentTab()=='encVirtualButtons'){
selectTab('encVirtualButtons');
}
}
function enclosureNameChanged(result){
var encName=getElementValueXpath(result,'//hpoa:enclosureName');
if(encName!=''){
top.mainPage.setMainTitle(encName);
}
}
function enclosureStatusChanged(result){
if(getCurrentTab()=='encStatus'){
selectTab('encStatus');
}
}
function load_show_all(){
openCgiWindow("cgi-bin/showAll",hpem);
}
function deRegisterEventHandler(){
try{
hpem.removeRegisteredHandler(uidStateChangeHandler);
hpem.removeRegisteredHandler(enclosureNameChanged);
hpem.removeRegisteredHandler(enclosureStatusChanged);
}
catch(e){}
}
</script>
</head>
<body style="padding:0px;margin:10px;" onload="pageLoad();" onunload="deRegisterEventHandler();">

  <div id="ID_BODY_PROXY">
    
    <table cellpadding="0" cellspacing="0" border="0" width="100%" ID="Table1">
      <tr>
        <td valign="bottom">
          <div class="tabSet" id="tabSet">
            <div class="tabOff" tabid="encStatus" contextId="FORM_ENC_STATUS" id="encStatus" contentLocation="../Templates/enclosureStatus.xsl"><script>document.write(top.getString('status'));</script></div>
            <div class="tabOff" tabid="encInfo" contextId="FORM_ENC_INFO" id="encInfo" contentLocation="../Templates/enclosureInfo.xsl"><script>document.write(top.getString('information'));</script></div>
            <div class="tabOff" tabid="encVirtualButtons" contextId="FORM_ENC_VIRTUAL_BUTTONS" id="encVirtualButtons" contentLocation="../Templates/encVirtualButtons.xsl" style="display:none;"><script>document.write(top.getString('virtualButtons'));</script></div>
            <div class="tabOff" style="display:none;" tabid="encComponentFirmware" contextId="FORM_ENC_COMPONENT_FIRMWARE" id="encComponentFirmware" contentLocation="../Templates/encComponentFirmware.xsl"><script>document.write(top.getString('componentFirmware'));</script></div>
            <div class="tabBottomLine"></div>
          </div>
        </td>
      </tr>
      <tr>
        <td style="padding-top:10px;" id="contentTableCell">
          <div id="bodyContent"></div>
          <div id="waitContainer" class="waitContainer"></div>
        </td>
      </tr>
    </table>

    <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
    </script>
    
  </div>
  
</body>
</html>
