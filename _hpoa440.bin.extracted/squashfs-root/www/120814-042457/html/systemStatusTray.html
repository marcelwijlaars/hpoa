<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>
<head>
	<title>HP BladeSystem Onboard Administrator</title>
  <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9"/>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="../css/default.css" />
	<link rel="stylesheet" type="text/css" href="../css/blue_theme.css" />
	<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css" />
	<link rel="stylesheet" type="text/css" href="../Help/stylesheets/help.css"/>
    
	<script type="text/javascript" src="../js/application.js"></script>
	<script type="text/javascript" src="../js/debugger.js"></script>
	<script type="text/javascript" src="../js/browser.js"></script>
	<script type="text/javascript" src="../js/helpTips.js"></script>    
	<script type="text/javascript" src="../js/EnvironConstants.js"></script>
	<script type="text/javascript" src="../js/tableManager.js"></script>
	<script type="text/javascript" src="../js/formManager.js"></script>
	<script type="text/javascript" src="../js/batchManager.js"></script>
	<script type="text/javascript" src="../js/displayManager.js"></script>
	<script type="text/javascript" src="../js/global.js"></script>
	<script type="text/javascript" src="../js/init.js"></script>
	<script type="text/javascript" src="../js/xml.js"></script>
	<script type="text/javascript" src="../js/xslt.js"></script>
	<script type="text/javascript" src="../js/enclosure.js"></script>
	<script type="text/javascript">
var encNum;
var hpemObj=null;
function loadContent(){
hpemObj=top.getTopology().getSelectedProxy();
encNum=top.getTopology().getSelectedProxy().getEnclosureNumber();
if(hpemObj){
loadSystemStatusTray();
reconcilePage();
var eventListPower=[
'EVENT_BLADE_POWER_STATE',
'EVENT_INTERCONNECT_POWER'
];
var eventListUid=[
'EVENT_OA_UID',
'EVENT_BLADE_UID',
'EVENT_INTERCONNECT_UID'
];
var eventListStatus=[
'EVENT_BLADE_STATUS',
'EVENT_BLADE_INSERTED',
'EVENT_BLADE_INSERT_COMPLETED',
'EVENT_BLADE_REMOVED',
'EVENT_BLADE_POWER_MGMT',
'EVENT_BLADE_SHUTDOWN',
'EVENT_BLADE_FAULT',
'EVENT_BLADE_CONNECT',
'EVENT_BLADE_DISCONNECT',
'EVENT_BLADE_GRP_CAP_TIMEOUT',
'EVENT_ILO_READY',
'EVENT_ILO_DEAD',
'EVENT_ILO_ALIVE',
'EVENT_PS_STATUS',
'EVENT_INTERCONNECT_STATUS',
'EVENT_INTERCONNECT_UID',
'EVENT_INTERCONNECT_RESET',
'EVENT_INTERCONNECT_REMOVED',
'EVENT_INTERCONNECT_INSERTED',
'EVENT_SWITCH_CONNECT',
'EVENT_SWITCH_DISCONNECT',
'EVENT_INTERCONNECT_HEALTH_LED',
'EVENT_INTERCONNECT_CPUFAULT',
'EVENT_INTERCONNECT_THERMAL',
'EVENT_OA_NAMES',
'EVENT_OA_STATUS',
'EVENT_OA_INFO'
];
var eventListFront=[
'EVENT_BLADE_INFO',
'EVENT_BLADE_MP_INFO',
'EVENT_ILO_HAS_IPADDRESS',
'EVENT_SBL_DOMAIN_INFO_CHANGED'
];
var eventListRear=[
'EVENT_FAN_INSERTED',
'EVENT_FAN_REMOVED',
'EVENT_FAN_STATUS',
'EVENT_INTERCONNECT_REMOVED',
'EVENT_INTERCONNECT_INSERTED',
'EVENT_INTERCONNECT_INFO'
];
var enclosureType=hpemObj.getEnclosureType();
if(enclosureType==EnclosureTypes.c3000){
eventListFront.push('EVENT_OA_STATUS');
eventListFront.push('EVENT_MEDIA_INSERTED');
eventListFront.push('EVENT_MEDIA_REMOVED');
eventListRear.push('EVENT_PS_INSERTED');
eventListRear.push('EVENT_PS_REMOVED');
eventListRear.push('EVENT_PS_INFO');
}else{
eventListRear.push('EVENT_OA_STATUS');
eventListFront.push('EVENT_PS_INSERTED');
eventListFront.push('EVENT_PS_REMOVED');
eventListFront.push('EVENT_PS_INFO');
}
hpemObj.registerEventHandler(objectStatusChanged,eventListStatus);
hpemObj.registerEventHandler(objectPowerStateChanged,eventListPower);
hpemObj.registerEventHandler(objectUidStateChanged,eventListUid);
hpemObj.registerEventHandler(frontViewChanged,eventListFront);
hpemObj.registerEventHandler(rearViewChanged,eventListRear);
hpemObj.registerEventHandler(enclosureNameChanged,['EVENT_ENC_NAMES','EVENT_ENC_INFO']);
hpemObj.registerEventHandler(enclosureUidChanged,['EVENT_ENC_UID']);
checkSelectedDevice();
}
}
function checkSelectedDevice(){
var selectedDevice=top.mainPage.getHiddenFrame().getSelectedDeviceId();
var bayNum=top.mainPage.getHiddenFrame().devNum;
var devType=top.mainPage.getHiddenFrame().devType;
if(selectedDevice!=''){
var infoObj=null;
var presence='';
switch(devType){
case BAY():
case MP():
case PM_BLADE():
case 'monarch':
case 'fw_blade':
infoObj=hpemObj.getBladeInfo(bayNum);
presence=getElementValueXpath(infoObj,'//hpoa:presence');
break;
case INTERCONNECT():
case PM_INTERCONNECT():
infoObj=hpemObj.getInterconnectTrayStatus(bayNum);
presence=getElementValueXpath(infoObj,'//hpoa:presence');
break;
case FAN():
infoObj=hpemObj.getFanInfo(bayNum);
presence=getElementValueXpath(infoObj,'//hpoa:presence');
break;
case POWER_SUPPLY():
infoObj=hpemObj.getPsInfo(bayNum);
presence=getElementValueXpath(infoObj,'//hpoa:presence');
break;
case ENCLOSURE_MANAGER():
case DVD():
case LCD():
presence='PRESENT';
default:
break;
}
if(presence=='PRESENT'){
highlightDevice(selectedDevice);
}
}
}
function loadSystemStatusTray(){
try{
var trayStylesheetPath='/120814-042457/Templates/systemStatusTray.xsl';
var processor=new XsltProcessor(trayStylesheetPath);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('encNum',encNum);
processor.addParameter('enclosureInfoDoc',hpemObj.getEnclosureInfo());
processor.addParameter('isTower',hpemObj.getIsTower());
if(top.mainPage.getStatusContainer().isStatusCollapsed()==true){
processor.addParameter('isCollapsed','true');
}
var trayHtml=processor.getOutput();
if(!processor.hasErrors()){
document.getElementById('bodyContent').innerHTML=trayHtml;
loadFrontView(hpemObj,encNum);
loadRearView(hpemObj,encNum);
}else{
document.getElementById('bodyContent').innerHTML=processor.getErrorOutput();
}
}catch(e){
top.logEvent("Load system status tray error: "+e.message,encNum,1,6);
}
}
function loadFrontView(hpemObj,encNum){
var frontViewHtml=transformFrontView(hpemObj,encNum);
var frontViewContainer=document.getElementById('enclosureFrontView'+encNum);
if(frontViewContainer&&frontViewHtml!=''){
frontViewContainer.innerHTML=frontViewHtml;
}
}
function loadRearView(hpemObj,encNum){
var rearViewHtml=transformRearView(hpemObj,encNum);
var rearViewContainer=document.getElementById('enclosureRearView'+encNum);
if(rearViewContainer&&rearViewHtml!=''){
rearViewContainer.innerHTML=rearViewHtml;
}
}
function objectPowerStateChanged(result){
var objectType=determineObjectType(result.xml);
var bayNumber=getElementValueXpath(result,'//hpoa:bayNumber');
var presence=getElementValueXpath(result,'//hpoa:presence');
var powerElement=document.getElementById('enc'+encNum+objectType+bayNumber+'Power');
if(powerElement&&presence=='PRESENT'){
var powerState=getElementValueXpath(result,'//hpoa:powered');
if(powerElement.src){
try{
var processor=new XsltProcessor('../Templates/powerLedSource.xsl');
processor.addParameter('powerState',powerState);
powerElement.src=processor.getOutput();
objectStatusChanged(result);
}catch(e){}
}else{
try{
var processor=new XsltProcessor('../Templates/powerLedExternal.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('powerState',powerState);
powerElement.innerHTML=processor.getOutput();
objectStatusChanged(result);
}catch(e){}
}
}
}
function objectUidStateChanged(result){
var objectType=determineObjectType(result.xml);
var bayNumber=getElementValueXpath(result,"//hpoa:bayNumber");
var uidImage=document.getElementById('enc'+encNum+objectType+bayNumber+'Uid');
if(uidImage){
var uidState=getElementValueXpath(result,"//hpoa:uid");
switch(uidState){
case UID_ON():
uidImage.src="/120814-042457/images/uid_small_on.gif";
break;
case UID_OFF():
uidImage.src="/120814-042457/images/uid_small_off.gif";
break;
case UID_BLINK():
uidImage.src="/120814-042457/images/uid_small_blink.gif";
break;
}
checkSelectedDevice();
}
}
function objectStatusChanged(result){
var objectType=determineObjectType(result.xml);
var bayNumber=getElementValueXpath(result,'//hpoa:bayNumber');
var presence=getElementValueXpath(result,'//hpoa:presence');
var statusElement=document.getElementById('enc'+encNum+objectType+bayNumber+'Status');
var statusCode=getElementValueXpath(result,'//hpoa:operationalStatus');
var healthLedElement=document.getElementById('enc'+encNum+objectType+bayNumber+'HealthBar');
if(healthLedElement){
if(healthLedElement.src){
var deviceFailure=getElementValueXpath(result,'//hpoa:diagnosticChecks/hpoa:deviceFailure');
var deviceDegraded=getElementValueXpath(result,'//hpoa:diagnosticChecks/hpoa:deviceDegraded');
var powerState=getElementValueXpath(result,'//hpoa:powered');
var health='OP_STATUS_UNKNOWN';
if(deviceFailure=='ERROR'&&deviceDegraded=='NO_ERROR'){
health='OP_STATUS_NON-RECOVERABLE_ERROR';
}else if(deviceFailure=='NO_ERROR'&&deviceDegraded=='ERROR'){
health='OP_STATUS_DEGRADED';
}else if(deviceFailure=='NO_ERROR'&&deviceDegraded=='NO_ERROR'){
health='OP_STATUS_OK';
}
switch(health){
case 'OP_STATUS_OK':
healthLedElement.src='/120814-042457/images/led-bar-green.gif';
healthLedElement.style.visibility=(powerState=="POWER_ON"?"visible":"hidden");
break;
case 'OP_STATUS_DEGRADED':
healthLedElement.src='/120814-042457/images/led-bar-amber-blink.gif';
healthLedElement.style.visibility="visible";
break;
case 'OP_STATUS_NON-RECOVERABLE_ERROR':
healthLedElement.src='/120814-042457/images/led-bar-red-blink.gif';
healthLedElement.style.visibility="visible";
break;
default:
}
}
}
if(statusElement&&statusElement.src){
if(statusCode=='OP_STATUS_OK'||(presence=='ABSENT'&&statusCode=='OP_STATUS_UNKNOWN')){
statusElement.style.visibility="hidden";
}else{
var processor=new XsltProcessor('../Templates/statusIconSource.xsl');
processor.addParameter('statusCode',statusCode);
statusElement.src=processor.getOutput();
statusElement.style.visibility="visible";
}
}else if(statusElement){
if(statusCode!='OP_STATUS_OK'&&((presence=='PRESENT'||presence=='')||(presence=='ABSENT'&&statusCode!='OP_STATUS_UNKNOWN'))){
try{
var processor=new XsltProcessor('../Templates/statusIconExternal.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('statusCode',statusCode);
statusElement.innerHTML=processor.getOutput();
}catch(e){}
}else{
statusElement.innerHTML='&#160;';
}
}
}
function frontViewChanged(result){
loadFrontView(hpemObj,encNum);
reconcilePage();
checkSelectedDevice();
}
function rearViewChanged(result){
loadRearView(hpemObj,encNum);
reconcilePage();
checkSelectedDevice();
}
function enclosureNameChanged(result){
var encName=getElementValue(result,'enclosureName',OA_NAMESPACE());
if(encName!=''){
document.getElementById('enclosureName').innerHTML=encName;
}
}
function enclosureUidChanged(result,encNum){
var linkNicUid=document.getElementById('enc'+encNum+'linkNic');
if(linkNicUid){
var uidState=getElementValueXpath(result,'//hpoa:uid');
if(uidState==UID_ON()){
linkNicUid.src='/120814-042457/images/uid_small_on.gif';
}else{
linkNicUid.src='/120814-042457/images/uid_small_off.gif';
}
}
}
function highlightDevice(devId,encId){
if(devId.indexOf('mp')){
devId=devId.replace('mp','bay');
}
if(devId.indexOf('pm_blade')>-1){
devId=devId.replace('pm_blade','bay');
}
if(devId.indexOf('pm_interconnect')>-1){
devId=devId.replace('pm_interconnect','interconnect');
}
if(devId.indexOf('fw_blade')>-1){
devId=devId.replace('fw_blade','bay');
}
encNum=top.mainPage.getHiddenFrame().getSelectedEnclosure();
var innerDiv=document.getElementById('frontViewInner'+encNum);
if(innerDiv){
var divCollection=innerDiv.getElementsByTagName('div');
for(var i=0;i<divCollection.length;i++){
if(divCollection[i].className=='deviceCellHighlight'||
divCollection[i].className=='deviceCellDashed'){
divCollection[i].className='deviceCell';
}
}
}
ourTableManager.clearHighlight();
if(devId.indexOf('monarch')>-1){
var domainInfo=hpemObj.getDomainInfo();
ourTableManager.selectCellById(devId);
devId=devId.replace('monarch','bay');
var bayNum=devId.substring(devId.indexOf('bay')+3,devId.indexOf('Select'))-0;
var bayList=new Array();
var partitions=getElementValueXpath(domainInfo,'//hpoa:domainInfo/hpoa:domains/hpoa:domain[hpoa:monarchBlade='+bayNum+']/hpoa:partitions',true);
if(partitions==null||partitions.childNodes.length<=0){
var auxBlades=getElementValueXpath(hpemObj.getBladeInfo(bayNum),'//hpoa:bladeInfo/hpoa:extraData[@hpoa:name="auxiliaryBlades"]');
var auxBladeList=auxBlades.split(',');
for(var i=0;i<auxBladeList.length;i++){
var dashId=devId.replace('bay'+bayNum,'bay'+auxBladeList[i]);
try{
document.getElementById(dashId).className='deviceCellDashed';
}catch(e){}
}
var monarchBlade=getElementValueXpath(hpemObj.getBladeInfo(bayNum),'//hpoa:bladeInfo/hpoa:extraData[@hpoa:name="monarchBlade"]');
if(monarchBlade!=''){
var dashId=devId.replace('bay'+bayNum,'bay'+monarchBlade);
try{
document.getElementById(dashId).className='deviceCellDashed';
}catch(e){}
}
}else{
for(var i=0;i<partitions.childNodes.length;i++){
if(partitions.childNodes[i].nodeType!='1')
continue;
var bays=partitions.childNodes[i].getElementsByTagName('hpoa:bay');
for(var j=0;j<bays.length;j++){
var dashNum=bays[j].firstChild.nodeValue;
var dashId=devId.replace('bay'+bayNum,'bay'+dashNum);
var dashCell=document.getElementById(dashId);
if(dashCell){
dashCell.className='deviceCellDashed';
}
}
}
}
return;
}
if(devId.indexOf('bay')>-1){
var encNum=devId.substring(devId.indexOf('enc')+3,devId.indexOf('bay'))-0;
var bayNum=devId.substring(devId.indexOf('bay')+3,devId.indexOf('Select'))-0;
var cell=document.getElementById(devId);
if(cell){
cell.className='deviceCellHighlight';
}
var dashNum=getElementValueXpath(hpemObj.getBladeInfo(bayNum),'//hpoa:bladeInfo/hpoa:extraData[@hpoa:name="AssociatedBlade"]');
if(dashNum&&dashNum>0){
var dashId=devId.replace('bay'+bayNum,'bay'+dashNum);
var dashCell=document.getElementById(dashId);
if(dashCell){
dashCell.className='deviceCellDashed';
}
}
dashNum=getElementValueXpath(hpemObj.getBladeInfo(bayNum),'//hpoa:bladeInfo/hpoa:extraData[@hpoa:name="AssociatedBlade2"]');
if(dashNum&&dashNum>0){
var dashId=devId.replace('bay'+bayNum,'bay'+dashNum);
var dashCell=document.getElementById(dashId);
if(dashCell){
dashCell.className='deviceCellDashed';
}
}
var auxBlades=getElementValueXpath(hpemObj.getBladeInfo(bayNum),'//hpoa:bladeInfo/hpoa:extraData[@hpoa:name="auxiliaryBlades"]');
var auxBladeList=auxBlades.split(',');
for(var i=0;i<auxBladeList.length;i++){
if(auxBladeList[i]==bayNum)
continue;
var dashId=devId.replace('bay'+bayNum,'bay'+auxBladeList[i]);
var dashCell=document.getElementById(dashId);
if(dashCell){
dashCell.className='deviceCellDashed';
}
}
var monarchBlade=getElementValueXpath(hpemObj.getBladeInfo(bayNum),'//hpoa:bladeInfo/hpoa:extraData[@hpoa:name="monarchBlade"]');
if(monarchBlade!=''&&bayNum!=monarchBlade){
var dashId=devId.replace('bay'+bayNum,'bay'+monarchBlade);
var dashCell=document.getElementById(dashId);
if(dashCell){
dashCell.className='deviceCellDashed';
}
}
}else{
ourTableManager.selectCellById(devId);
}
}
function deRegisterEventHandler(){
if(hpemObj){
try{
hpemObj.removeRegisteredHandler(frontViewChanged);
hpemObj.removeRegisteredHandler(rearViewChanged);
hpemObj.removeRegisteredHandler(enclosureNameChanged);
hpemObj.removeRegisteredHandler(objectStatusChanged);
hpemObj.removeRegisteredHandler(objectPowerStateChanged);
hpemObj.removeRegisteredHandler(objectUidStateChanged);
hpemObj.removeRegisteredHandler(enclosureUidChanged);
}catch(e){}
}
}
try{
top.mainPage.getHiddenFrame().addDeviceChangedHandler(highlightDevice);
}catch(e){}
	 </script>
	
</head>

<body style="margin:0px;background-color:#ccc;" onload="loadContent();" onunload="deRegisterEventHandler();">
	<div id="bodyContent"></div>
	<div id="waitContainer"></div>
</body>
</html>
