<!--  (C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var encNum;
var contextId="FORM_OA_FORCE_FAILOVER";
var mode;
var hpem=null;
var formMgr=null;
function loadContent(){
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
emNum=parseInt(getSearchValue(location.search,'emNum'));
mode=getSearchValue(location.search,'mode');
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
var processor=new XsltProcessor('../Templates/forceFailover.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('mode',mode);
document.getElementById('bodyContent').innerHTML=processor.getOutput();
reconcilePage();
if(mode=='active'){
hpem.registerEventHandler(oaStatusChanged,['EVENT_OA_REMOVED','EVENT_OA_STATUS']);
}
if(!isNaN(emNum)){
var oaStatus=hpem.getOaStatus(emNum);
if(getElementValueXpath(oaStatus,'//hpoa:oaRole')==STANDBY()){
contextId="FORM_STDBY_OA_FORCE_FAILOVER";
}
}
top.mainPage.getHelpLauncher().setCurrentTopic(contextId);
}
else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('bodyContent',[e.message]);
}
}
function forceFailover(){
var confirmString=top.getString('confirmTransitRedundancyOA');
if(mode=='active'){
confirmString+='\n\n'+top.getString('noteActiveOAResetImmediately');
}
if(confirm(confirmString)){
if((mode=='active'&&hpem.getActiveFirmwareVersion()>=3.50)||top.checkStandby()){
var formMgr=new FormManager(function(success){
if(success){
top.getTopology().selectPrimaryEnclosure();
ourButtonManager.disableButtonById('failoverButton');
if(hpem.getIsLocal()==true){
top.getTopology().failOverPrimaryEnclosure(true,mode);
}else{
hpem.setIsAuthenticated(false);
top.getTopology().removeProxy(hpem.getUuid());
top.mainPage.goHome();
}
}
});
formMgr.createWaitContainer(top.getString("requestingManualTakeover"));
formMgr.startBatch();
formMgr.queueCall(hpem.oaManualFailover);
formMgr.endBatch();
}else{
if(mode=='active'){
top.getTopology().selectPrimaryEnclosure();
ourButtonManager.disableButtonById('failoverButton');
if(hpem.getIsLocal()==true){
top.getTopology().failOverPrimaryEnclosure(false);
}else{
hpem.oaManualFailover(function(){});
hpem.setIsAuthenticated(false);
top.getTopology().removeProxy(hpem.getUuid());
top.mainPage.goHome();
}
}else{
hpem.oaManualFailover(function(){});
}
}
}
}
function oaStatusChanged(result){
var redundancy=getElementValueXpath(result,'//hpoa:oaRedundancy');
if(redundancy=='false'){
document.getElementById('bodyContent').innerHTML=top.getString('standbyOARemoved');
}
else{
loadContent();
}
}
function deRegisterEvents(){
if(hpem!=null){
hpem.removeRegisteredHandler(oaStatusChanged);
}
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="deRegisterEvents();">
  <div id="bodyContent"></div>
  <div id="waitContainer" class="waitContainer"></div>
</body>
</html>
