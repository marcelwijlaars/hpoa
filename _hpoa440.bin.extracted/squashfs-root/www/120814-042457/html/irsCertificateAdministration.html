<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html>
<head>
<!--
  (C) Copyright 2013 Hewlett-Packard Development Company, L.P.
-->
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css"/>
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css"/>
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css"/>
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/batchManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript">
var emNum;
var encNum;
var hpem=null;
function loadContent(){
try{
emNum=parseInt(getSearchValue(location.search,'emNum'));
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
ourTabManager.toggleTabs('irsCertinfo');
setTabContent('irsCertinfo');
hpem.registerEventHandler(certificateEventHandler,['EVENT_ERS_CA_CERT_ADDED','EVENT_ERS_CA_CERT_REMOVED']);
}else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function setTabContent(tabId){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextId=contentTab.getAttribute('contextId');
top.mainPage.getHelpLauncher().setCurrentTopic(contextId);
if(hpem==null){
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
return;
}
try{
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('certsdoc',hpem.getErsCertificatesInfo());
if(tabId=="irsCertinfo"){
processor.addParameter("type","irsCerts");
}
document.getElementById('tabContent').innerHTML=processor.getOutput();
reconcilePage();
},false,'errorDisplay','tabContent','waitContainer');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getErsCertificatesInfo);
formMgr.endBatch();
}catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
function uploadCertificate(){
var confirmUpload=top.getString('certWillBeUploaded')+'\n'+top.getString('areYouSure');
var certContent=getInputValue('certificateContents');
if(certContent!=''){
if(confirm(confirmUpload)){
var formMgr=new FormManager(function(){
if(success){
formMgr.displayManager.showWaitScreen();
}
},false,'errorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('completingCertificateUpload'));
formMgr.batchEventDelay=3;
formMgr.startBatch();
formMgr.queueCall(hpem.addErsCertificate,[certContent]);
formMgr.endBatch();
}
}else{
alert(top.getString('pleaseEnterCertContents'),AlertMsgTypes.Warning);
}
}
function downloadCertificate(){
var confirmDownload=top.getString('certWillBeDownloaded')+'\n'+top.getString('areYouSure');
var certUrl=getInputValue('certUrl');
if(certUrl!=''){
if(confirm(confirmDownload)){
var formMgr=new FormManager(function(){
if(success){
formMgr.displayManager.showWaitScreen();
}
},false,'errorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('downloadingCertificate'));
formMgr.batchEventDelay=3;
formMgr.startBatch();
formMgr.queueCall(hpem.downloadErsCertificate,[certUrl]);
formMgr.endBatch();
}
}else{
alert(top.getString('pleaseProvideValidUrl'),AlertMsgTypes.Warning);
}
}
function removeCertificate(fingerprint){
var confirmRemove=top.getString('reallyDeleteCertificate');
if(fingerprint&&fingerprint!=''){
if(confirm(confirmRemove)){
var formMgr=new FormManager(function(){
if(success){
formMgr.displayManager.showWaitScreen();
}
},false,'errorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('removingCertificate'));
formMgr.batchEventDelay=3;
formMgr.startBatch();
formMgr.queueCall(hpem.removeErsCertificate,[fingerprint.toLowerCase().replace(/\:/g,"")]);
formMgr.endBatch();
}
}else{
alert(top.getString('noFingerPrintPresent'),AlertMsgTypes.Warning);
}
}
function certificateEventHandler(result){
var eventName=getElementValueXpath(result,"//hpoa:event");
switch(eventName){
case 'EVENT_ERS_CA_CERT_ADDED':
case 'EVENT_ERS_CA_CERT_REMOVED':
if(getCurrentTab()=='irsCertupload'){
ourTabManager.toggleTabs('irsCertinfo');
}
top.mainPage.showNotice(top.getString("certificate"+(eventName.indexOf("ADDED")>-1?"Added":"Removed")),top.getString("irsCertificates"),AlertMsgTypes.Normal,null,10);
setTabContent("irsCertinfo");
break;
default:
}
}
function deRegisterHandlers(){
if(hpem!=null){
hpem.removeRegisteredHandler(certificateEventHandler);
}
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="deRegisterHandlers();">
    <div id="bodyContent">

    <h5 style="margin-bottom:15px;"><script type="text/javascript">document.write(top.getString('irsCertificates'));</script></h5>
  
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
      <tr>
        <td valign="bottom">
            <div class="tabSet" id="tabSet">                
              <div class="tabOff" tabid="irsCertinfo" contextId="FORM_IRS_CERTIFICATE_INFO" id="irsCertinfo" contentLocation="../Templates/CAcertificateinfo.xsl"><script type="text/javascript">document.write(top.getString('certificateInformation'));</script></div>
              <div class="tabOff" tabid="irsCertupload" contextId="FORM_IRS_CERTIFICATE_UPLOAD" id="irsCertupload" contentLocation="../Templates/CAcertificateupload.xsl"><script type="text/javascript">document.write(top.getString('certificateUpload'));</script></div>
              
            <div class="tabBottomLine"></div>
          </div>
          
        </td>
      </tr>
      <tr>
        <td style="padding-top:10px;">
          <div id="tabContent"></div>
          <div id="waitContainer" class="waitContainer"></div>
        </td>
      </tr>
    </table>

    <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
    </script>
    
  </div>
</body>
</html>
