<!--  (C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css"/>
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css"/>
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css"/>
<link rel="stylesheet" type="text/css" href="../Help/stylesheets/help.css" />
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/batchManager.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script> 
<script type="text/javascript" src="../js/helpTips.js"></script>   
<!-- Include snmp.js for the checkListPopulate function -->
<script type="text/javascript" src="../js/snmp.js"></script>    
<script type="text/javascript">	
var encNum;
var hpem=null;
var eventsIgnored=0;
var batchInProgress=false;
var fwVersion=0;
var userAcl="";
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function loadContent(){
encNum=parseInt(getSearchValue(location.search,'encNum'));
var tabRef=getSearchValue(location.search,'tabid');
var initTab="protocolTab";
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
fwVersion=hpem.getActiveFirmwareVersion();
userAcl=hpem.getUserAccessLevel();
if(fwVersion>=2.30){
document.getElementById('anonymousDataTab').style.display='block';
}
if(userAcl=='ADMINISTRATOR'){
document.getElementById('trustedIpTab').style.display='block';
if(fwVersion>=3.60){
document.getElementById('loginBannerTab').style.display='block';
hpem.registerEventHandler(bannerSettingsChanged,['EVENT_OA_LOGIN_BANNER_SETTINGS_CHANGED']);
}
if(fwVersion>=3.70){
document.getElementById('fipsTab').style.display='block';
hpem.registerEventHandler(handleVcmEvent,['EVENT_OA_VCM','EVENT_VCM_FQDN_INFO_REFRESH']);
}
}
if(tabRef!=""){
var tab=document.getElementById(tabRef);
if(tab&&tab.style.display=="block"){
initTab=tabRef;
}
}
hpem.registerEventHandler(networkInfoChanged,['EVENT_NETWORK_INFO_CHANGED']);
hpem.registerEventHandler(bladeMpInfoChanged,['EVENT_BLADE_MP_INFO','EVENT_ILO_HAS_IPADDRESS','EVENT_BLADE_REMOVED','EVENT_BLADE_FQDN_INFO_REFRESH']);
ourTabManager.toggleTabs(initTab);
setTabContent(initTab,false,true);
}else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}
function load_xml(){
window.open(getXmlReplyCommand());
}
function getXmlReplyCommand(){
return(hpem.getIsLocal()?getServiceUrl('',true):getServiceUrl(hpem.getProxyUrl(),true))+'xmldata?item=all';
}
function setTabContent(tabId,fresh,init){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextHelpId=contentTab.getAttribute('contextId');
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('vcmMode',hpem.getOaVcmMode());
processor.addParameter('inWizard','false');
if(tabId=="loginBannerTab"){
processor.addParameter("loginBannerSettings",formMgr.getDataByCallName("getLoginBannerSettings"));
}else{
processor.addParameter('networkInfoDoc',hpem.getEnclosureNetworkInfo());
processor.addParameter('xmlReplyUrl',getXmlReplyCommand());
processor.addParameter('fwVersion',fwVersion);
if(tabId=='fipsTab'&&fwVersion>=4.30){
processor.addParameter('sslSettingsInfoDoc',hpem.getSslSettings());
}
}
document.getElementById('tabContent').innerHTML=processor.getOutput();
if(tabId=="protocolTab"){
showFederatedBladeList();
}
reconcilePage();
pageAdjust();
top.mainPage.getHelpLauncher().setCurrentTopic(contextHelpId);
}else{
displayContentFailed('tabContent',formMgr.getErrorsArray());
}
},false,'','tabContent');
if(assertTrue(init)==false){
formMgr.startTransactionBatch(assertFalse(fresh));
}else{
formMgr.startBatch(true,assertFalse(fresh));
}
if(tabId=="loginBannerTab"){
formMgr.queueCall(hpem.getLoginBannerSettings);
}else{
formMgr.queueCall(hpem.getEnclosureNetworkInfo);
if(tabId=='fipsTab'&&fwVersion>=4.30){
formMgr.queueCall(hpem.getSslSettings);
}
}
formMgr.endBatch();
}
function pageAdjust(){
switch(getCurrentTab()){
case "loginBannerTab":
try{
var txtarea=document.getElementById("txtLoginBanner");
var page=getDocumentCoords(txtarea);
txtarea.style.width=((page.width-page.scrollX)-(document.all?30:20));
}catch(e){}
break;
default:
break;
}
}
function jumpToiLOPage(bayNumber){
if(bayNumber){
top.mainPage.getHiddenFrame().selectDevice(bayNumber,"mp",encNum,true,true);
}
}
function showFederatedBladeList(){
var label=document.getElementById("lblSupportedBladesList");
if(label){
label.innerHTML=getAnimatedTimerHTML(top.getString("loading..."));
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor('../Templates/protocols.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('mpInfoDoc',hpem.getBladeMpInfoDOM());
processor.addParameter('templateName','federatedBladeList');
label.innerHTML=(processor.hasErrors()?"":processor.getOutput());
}else{
label.innerHTML="";
}
},false,'','','');
formMgr.startTransactionBatch(false);
formMgr.queueCall(hpem.getBladeMpInfoAll)
formMgr.endBatch();
}
}
function networkInfoChanged(result){
var currentTab=getCurrentTab();
if(currentTab=="protocolTab"||currentTab=="trustedIpTab"){
setTabContent(currentTab,false,false);
}
}
function bladeMpInfoChanged(result){
if(getCurrentTab()=="protocolTab"){
showFederatedBladeList();
}
}
function bannerSettingsChanged(result){
if(getCurrentTab()=="loginBannerTab"){
if(batchInProgress){
eventsIgnored++;
return;
}
setTabContent("loginBannerTab");
}
}
function setNetworkProtocols(){
var http=document.getElementById('httpAccess').checked;
var ssh=document.getElementById('sshAccess').checked;
var telnet=document.getElementById('telnetAccess').checked;
var xmlreply=document.getElementById('xmlReplyAccess').checked;
var iLOFederationElem=document.getElementById('iLOFederationEnable');
var fqdnElem=document.getElementById('FqdnSwitch');
var confirmString;
var fipsEnabled=false;
var confirmString=top.getString('reallyDisableHttps');
confirmString+='\n'+top.getString('disablingThisWillDisconnectYou');
if((!http&&confirm(confirmString))||http){
var formMgr=new FormManager(function(success){
if(!http){
document.getElementById('protocolErrorDisplay').style.display='none';
}
},false,'protocolErrorDisplay','tabContent','waitContainer');
var waitPhrase=top.getString('completingNetworkAccess');
var waitDescription=top.getString('completingNetworkAccessDes');
formMgr.createWaitContainer(waitPhrase,waitDescription);
formMgr.startBatch();
formMgr.batchEventDelay=3;
formMgr.queueCall(hpem.setNetworkProtocols,[http,ssh,telnet,xmlreply,fipsEnabled],[],['83','84']);
if(iLOFederationElem){
var label=document.getElementById("lblSupportedBladesList");
if(label){
label.innerHTML=(iLOFederationElem.checked?getAnimatedTimerHTML(top.getString("loading...")):"");
}
formMgr.queueCall(hpem.setNetworkProtocol,[NET_PROTO_ILO_FEDERATION(),iLOFederationElem.checked],[],['83','84']);
}
if(fqdnElem){
formMgr.queueCall(hpem.setNetworkProtocol,[NET_PROTO_FQDN(),fqdnElem.checked],[],['83','84']);
}
formMgr.endBatch();
}
}
function setSslSettings(){
var sslSettingsDoc=hpem.getSslSettings().cloneNode(true);
var protocolDiv=document.getElementById("protocolOptionsContainer");
var cipherDiv=document.getElementById("cipherOptionsContainer");
if(!(cipherDiv&&protocolDiv)){
return;
}
if(!confirm(top.getString("warning")+" "+top.getString("modifySettingsCauseWebRestart")+"\n\n"+top.getString("clickOkToContinue"))){
return;
}
var protocols=protocolDiv.getElementsByTagName("input");
for(var i=0;i<protocols.length;i++){
setNodeValueXpath(sslSettingsDoc,"//hpoa:protocol[hpoa:name='"+protocols[i].id+"']/hpoa:enabled",(protocols[i].checked?'true':'false'),false);
}
var ciphers=cipherDiv.getElementsByTagName("input");
for(i=0;i<ciphers.length;i++){
setNodeValueXpath(sslSettingsDoc,"//hpoa:cipher[hpoa:name='"+ciphers[i].id+"']/hpoa:enabled",(ciphers[i].checked?'true':'false'),(i==ciphers.length-1));
}
var formMgr=new FormManager(function(success){
if(success){
}
},false,'sslSettingsErrorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString("applyingSecuritySettings"));
formMgr.batchEventDelay=3;
formMgr.startBatch();
formMgr.queueCall(hpem.setSslSettings,[getElementValueXpath(sslSettingsDoc,"//hpoa:sslSettingsInfo",true)]);
formMgr.endBatch();
}
function setIpSecurity(){
var ipSecEnabled=document.getElementById('ipSecEnabled').checked;
var addressList=document.getElementById('selectedAddresses');
if((ipSecEnabled&&addressList.options.length>0)||!ipSecEnabled){
var formMgr=new FormManager(null,false,'securityErrorDisplay','tabContent','waitContainer');
var waitPhrase=top.getString('completingNetworkAccess');
var waitDescription=top.getString('completingNetworkAccessDes');
formMgr.createWaitContainer(waitPhrase,waitDescription);
formMgr.startBatch();
formMgr.queueCall(hpem.setNetworkProtocol,['NET_PROTO_IPSECURITY',ipSecEnabled],[],['83','84']);
formMgr.endBatch();
}else{
var warningString=top.getString('mustAddAtLeastOneIpAddress');
warningString+='\n('+top.getString('shouldAddYourOwnIpAddress')+')';
alert(warningString);
}
}
function addTrustedHost(){
var ipAddress=document.getElementById('IPAddress').value;
if(ipAddress!=''){
toggleAddressFormEnabled(false);
var formMgr=new FormManager(function(success){
toggleAddressFormEnabled(true);
checkListPopulated();
},false,'securityErrorDisplay','','');
formMgr.startBatch();
formMgr.queueCall(hpem.addTrustedIpAddress,[ipAddress]);
formMgr.endBatch();
}else{
alert(top.getString('invalidIpAddress'));
}
}
function removeTrustedHosts(){
var addressList=document.getElementById('selectedAddresses');
var addresses=new Array();
for(var i=0;i<addressList.options.length;i++){
if(addressList.options[i].selected==true){
addresses.push(addressList.options[i].value);
}
}
if(addresses.length>0){
toggleAddressFormEnabled(false);
var formMgr=new FormManager(function(success){
toggleAddressFormEnabled(true);
checkListPopulated();
},false,'securityErrorDisplay','','');
formMgr.startBatch();
for(var i=0;i<addresses.length;i++){
formMgr.queueCall(hpem.removeTrustedIpAddress,[addresses[i]],[],['32']);
}
formMgr.endBatch();
}
}
function toggleAddressFormEnabled(enabled){
var ipText=document.getElementById('IPAddress');
if(enabled){
ourButtonManager.enableButtonById('ipTransfer_Add');
ourButtonManager.enableButtonById('ipTransfer_Remove');
ipText.removeAttribute('disabled');
}else{
ourButtonManager.disableButtonById('ipTransfer_Add');
ourButtonManager.disableButtonById('ipTransfer_Remove');
ipText.setAttribute('disabled','true');
}
}
function setEnclosureIp(){
var enclosureIpEnabled=document.getElementById('enclosureIpEnabled').checked;
var ipAddress=document.getElementById('ipAddress').value;
var netmask=document.getElementById('netmask').value;
var gateway=document.getElementById('gateway').value;
var ourInputValidator=new InputValidator(null,'errorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
return;
}else{
ourInputValidator.clearMessages();
}
var formMgr=new FormManager(null,false,'errorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('completingEncIpAddressSetting'));
formMgr.makeCall(hpem.setRoamingIpInfo,[ipAddress,netmask,gateway,enclosureIpEnabled]);
}
function setAnonymousData(){
var guiLoginDetail;
if(document.getElementById('guiLoginDetail')){
guiLoginDetail=document.getElementById('guiLoginDetail').checked;
}
var formMgr=new FormManager(function(success){
},false,'anonDataErrorDisplay','tabContent','waitContainer');
var waitPhrase=top.getString('completingNetworkAccess');
var waitDescription=top.getString('completingNetworkAccessDes');
formMgr.createWaitContainer(waitPhrase,waitDescription);
formMgr.startBatch();
if(existsNonNull(guiLoginDetail)){
formMgr.queueCall(hpem.setNetworkProtocol,[NET_PROTO_GUI_LOGIN_DETAIL(),guiLoginDetail],[],['83','84']);
}
formMgr.endBatch();
}
function applyLoginBannerSettings(){
var inputValidator=new InputValidator(null,'errorDisplay',true);
if(!inputValidator.allInputsValidate()){
inputValidator.updateMessages(true);
return;
}else{
inputValidator.clearMessages();
}
var bannerEnabled=getInputValue("chkEnableLoginBanner");
var bannerText=getInputValue("txtLoginBanner");
if(bannerText.replace(/\s+/g,"")==""&&bannerEnabled==false){
bannerText="";
setInputValue("txtLoginBanner","");
updateCharCount("");
}
batchInProgress=true;
var formMgr=new FormManager(function(success){
batchInProgress=false;
if(success){
if(eventsIgnored>0){
eventsIgnored=0;
setTabContent(getCurrentTab(),false,false);
}
}
},false,"errorDisplay","tabContent","waitContainer");
formMgr.createWaitContainer(top.getString("applyingSettingsPleaseWait"));
formMgr.batchEventDelay=5;
formMgr.startBatch();
formMgr.queueCall(hpem.setLoginBannerSettings,[bannerEnabled,bannerText],[],['286','287']);
formMgr.endBatch();
}
function updateCharCount(bannerText){
var total=bannerText.replace(/\r/ig,"").length;
setInnerHTML("lblCharCount",total>1500?"<font style='color:#cc0000;'>"+total+"</font>":total);
}
function updateValidation(chkBox){
var textBox=document.getElementById("txtLoginBanner");
if(textBox){
textBox.setAttribute("rule-list",(chkBox.checked?"6;11;16":"11"));
}
}
function unloadPage(){
try{
if(hpem){
if(userAcl=="ADMINISTRATOR"){
if(fwVersion>=3.60){
hpem.removeRegisteredHandler(bannerSettingsChanged);
}
if(fwVersion>=3.70){
hpem.removeRegisteredHandler(handleVcmEvent);
}
}
hpem.removeRegisteredHandler(networkInfoChanged);
hpem.removeRegisteredHandler(bladeMpInfoChanged);
}
}catch(e){}
}
function handleVcmEvent(result){
if(getCurrentTab()=="fipsTab"){
var enabled=getElementValueXpath(result,'//hpoa:oaVcmMode/hpoa:isVcmMode');
if(enabled=='false'){
toggleElementVisible('fipsErrorDisplay',false);
}
setInnerHTML('vcModeLbl',top.getString(enabled=='false'?'disabled':'enabled'));
}
}
function fipsRadioOnChange(fipsSelected){
if(fwVersion>=4.35){
return;
}
var controlElements=['password','passwordConfirm','passContainer'];
if(fipsSelected.value==OA_FIPS_MODE_OFF()){
for(var el in controlElements){
toggleFormEnabled(controlElements[el],false);
}
}
else{
for(var el in controlElements){
toggleFormEnabled(controlElements[el],true);
}
}
}
function checkFipsMode(newFipsModeParam)
{
var newFipsMode=newFipsModeParam||getOptionGroupValue("fipsMode");
if(hpem.getProperty("FipsMode")==newFipsMode){
alert(top.getString("fipsAlreadySelected"));
return false;
}
return true;
}
function setFipsModeConfirmation(formMgr,newFipsMode){
var confirmationString=top.getString(newFipsMode+'-confirmation');
formMgr.createWaitContainer(top.getString('fipsModeWait'));
return confirm(confirmationString);
}
function setFipsMode(){
var formMgr=new FormManager(function(success){},false,'fipsErrorDisplay',
'tabContent','waitContainer');
var newFipsMode=getOptionGroupValue("fipsMode");
var fipsConfirmation=false;
if(!checkFipsMode(newFipsMode))
return;
if(newFipsMode!=OA_FIPS_MODE_OFF()||fwVersion>=4.35){
var newAdmPass=getInputValue('password');
var ourfipsInputValidator=new InputValidator(null,'fipsErrorDisplay',true);
if(!ourfipsInputValidator.allInputsValidate()){
ourfipsInputValidator.updateMessages(true);
ourfipsInputValidator.autoFocus();
return;
}
}
fipsConfirmation=setFipsModeConfirmation(formMgr,newFipsMode);
if(fipsConfirmation){
formMgr.makeCall(hpem.setFipsMode,[newFipsMode,newAdmPass]);
return true;
}
return false;
}
function clearVcmMode(){
var confirmString=top.getString('clearVcConfirm');
if(confirm(confirmString)){
var formMgr=new FormManager(function(success){
if(success){
alert(top.getString('vcCleared'),AlertMsgTypes.Information);
}
},false,'clearVcErrorDisplay','bodyContent','waitContainer');
formMgr.createWaitContainer(top.getString('vcClearWaitMsg'));
formMgr.makeCall(hpem.clearOaVcmMode);
}
}
</script>

</head>
<body style="margin: 10px;" onload="loadContent();" onunload="unloadPage();" onresize="pageAdjust();">
    <div id="helpTooltip" class="popupSmallWrapper">
      <div class="popupSmallTitle"><img alt="" src="/120814-042457/images/icons/help-popup.gif" /></div>
      <div id="tooltipText" class="helpPopupSmallBody" style="color:#000;"></div>
    </div>    
    <div id="bodyContent">
        <table cellpadding="0" cellspacing="0" border="0" width="100%">
          <tr>
            <td valign="bottom">
              <div class="tabSet" id="tabSet">
                <div class="tabOff" style="display:block;" tabid="protocolTab" contextId="FORM_NETWORK_ACCESS" id="protocolTab" contentLocation="../Templates/protocols.xsl"><script type="text/javascript">document.write(top.getString('protocols'));</script></div>
                <div class="tabOff" style="display:none;" tabid="trustedIpTab" contextId="FORM_TRUSTED_IP" id="trustedIpTab" contentLocation="../Templates/trustedIp.xsl"><script type="text/javascript">document.write(top.getString('trustedHosts'));</script></div>
                <div class="tabOff" style="display:block;" tabid="anonymousDataTab" contextId="FORM_ANONYMOUS_DATA" id="anonymousDataTab" contentLocation="../Templates/anonymousData.xsl"><script type="text/javascript">document.write(top.getString('anonymousData'));</script></div>
                <div class="tabOff" style="display:none;" tabid="fipsTab"contextId="FORM_FIPS" id="fipsTab" contentLocation="../Templates/fips.xsl"><script type="text/javascript">document.write(top.getString('fips'));</script></div>
                <div class="tabOff" style="display:none;" tabid="loginBannerTab" contextId="FORM_LOGIN_BANNER" id="loginBannerTab" contentLocation="../Templates/loginBannerSettings.xsl"><script type="text/javascript">document.write(top.getString('loginBanner'));</script></div>
                <div class="tabBottomLine"></div>
              </div>
            </td>
          </tr>
          <tr>
            <td style="padding-top:10px;">
              <div id="tabContent"></div>
              <div id="waitContainer"></div>
            </td>
          </tr>
        </table> 

        <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
        </script>

    </div>
  
</body>
</html>
