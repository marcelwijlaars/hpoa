<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<link rel="stylesheet" type="text/css" href="../Help/stylesheets/help.css" />
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript" src="../js/helpTips.js"></script>

<script type="text/javascript">
var emNum;
var encNum;
var oaRole='';
var hpem=null;
function initPage(){
emNum=parseInt(getSearchValue(location.search,'emNum'));
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(emNum)&&!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
hpem.registerEventHandler(handleOaEvent,['EVENT_OA_NAMES','EVENT_OA_STATUS','EVENT_OA_INFO','EVENT_OA_UID']);
selectTab('oaStatusInfo');
var usbMode=getElementValueXpath(hpem.getEnclosureInfo(),'//hpoa:enclosureInfo/hpoa:extraData[@hpoa:name="usbMode"]');
if(usbMode!=''&&usbMode!='USB_NOT_SUPPORTED'){
document.getElementById('encUsb').style.display='block';
}
}
else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}
function selectTab(tabId){
try{
ourTabManager.toggleTabs(tabId);
setTabContent(tabId);
}
catch(e){}
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function setTabContent(tabId){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextHelpId=contentTab.getAttribute('contextId');
if(contentLocation){
try{
if(hpem!=null){
var oaStatusDoc=hpem.getOaStatus(emNum);
oaRole=getElementValueXpath(oaStatusDoc,'//hpoa:oaRole');
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('oaInfoDoc',hpem.getOaInfo(emNum));
processor.addParameter('oaStatusDoc',oaStatusDoc);
if(oaRole!=STANDBY()){
processor.addParameter('oaThermalsDoc',hpem.getOaThermals(emNum));
}
processor.addParameter('oaNetworkInfoDoc',hpem.getOaNetworkInfoDOM());
processor.addParameter('enclosureInfoDoc',hpem.getEnclosureInfo());
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('serviceUserOaAccess',hpem.getUserOaPermission());
processor.addParameter('isStandby',top.checkStandby());
processor.addParameter('enclosureVersion',hpem.getActiveFirmwareVersion());
document.getElementById('tabContent').innerHTML=processor.getOutput();
if(oaRole==STANDBY()){
contextHelpId=contentTab.getAttribute('contextIdStandby');
}
top.mainPage.getHelpLauncher().setCurrentTopic(contextHelpId);
reconcilePage();
},true,'','tabContent');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getOaInfo,[emNum]);
formMgr.queueCall(hpem.getOaStatus,[emNum]);
if(oaRole!=STANDBY()){
formMgr.queueCall(hpem.getOaThermals,[emNum]);
}
formMgr.endBatch();
}
else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
}
function setUidState(state){
hpem.setOaUid(emNum,state,function(){});
}
function handleOaEvent(result){
var roleFromEvent=getElementValueXpath(result,'//hpoa:oaRole')
var msg='The Standby Onboard Administrator was removed.';
if(oaRole=='STANDBY'&&roleFromEvent=='ACTIVE'){
var oaRedundancy=getElementValueXpath(result,'//hpoa:oaRedundancy');
if(oaRedundancy=='false'){
document.getElementById('bodyContent').innerHTML=msg;
}
}
else if(oaRole=='STANDBY'&&roleFromEvent=='OA_ABSENT'){
document.getElementById('bodyContent').innerHTML=msg;
}
else if(roleFromEvent==oaRole||getElementValueXpath(result,'//hpoa:event')=='EVENT_OA_INFO'){
setTabContent(getCurrentTab());
}
}
function restartEM(){
var oaStatusDOM=hpem.getOaStatusDOM();
var oaMode=getElementValueXpath(oaStatusDOM,'//hpoa:oaStatus[hpoa:bayNumber="'+emNum+'"]/hpoa:oaRole');
var isStandby=top.mainPage.checkIsStandby();
var confirmString='';
if(oaMode=='ACTIVE'||isStandby==true){
confirmString=top.getString('areYouSure')+' '+top.getString('youWillBeLoggedOutAndDisconnected');
}
else{
confirmString=top.getString('reallyResetStandby');
}
if(confirm(confirmString)){
hpem.resetOa(emNum,5,function(result){
if(oaMode=='STANDBY'&&!isStandby){
alert(top.getString('pleaseWait')+' '+top.getString('standbyResetCompleteIn30Seconds'));
}else if(!hpem.getIsLocal()&&oaMode=='ACTIVE'){
top.getTopology().removeProxy(hpem.getUuid());
hpem.setIsAuthenticated(false);
}
});
}
}
function setEnclosureUsbMode(){
var usbMode='';
var confirmString=top.getString('confirmUSBcontrollerChange');
if(!confirm(confirmString)){
return;
}
if(document.getElementById('usb_dvd').checked){
usbMode='USB_DVD_ENABLED';
}
else{
usbMode='USB_KVM_ENABLED';
}
var formMgr=new FormManager();
formMgr.createWaitContainer(top.getString('settingUSBMode'));
formMgr.makeCall(hpem.setEnclosureUsbMode,[usbMode]);
}
function deregisterMe(){
if(hpem){
hpem.removeRegisteredHandler(handleOaEvent);
}
}
</script>
</head>
<body style="margin:10px;" onload="initPage();" onunload='deregisterMe();'>
	
	<div id="bodyContent">
	
		<table cellpadding="0" cellspacing="0" border="0" width="100%">
			<tr>
				<td valign="bottom">
					<div class="tabSet" id="tabSet">
						<div class="tabOff" tabid="oaStatusInfo" contextIdStandby="FORM_STDBY_OA_INFO" contextId="FORM_OA_INFO" id="oaStatusInfo" contentLocation="../Templates/oaContent.xsl"><script type="text/javascript">document.write(top.getString('statusAndInfo'));</script></div>
						<div class="tabOff" tabid="oaVirtualButtons" contextIdStandby="FORM_STDBY_OA_VIRTUAL_BUTTONS" contextId="FORM_OA_VIRTUAL_BUTTONS" id="oaVirtualButtons" contentLocation="../Templates/oaVirtualButtons.xsl"><script type="text/javascript">document.write(top.getString('virtualButtons'));</script></div>
						<div class="tabOff" tabid="encUsb" contextIdStandby="FORM_ENC_USB" contextId="FORM_ENC_USB" id="encUsb" contentLocation="../Templates/encUsb.xsl" style="display:none;">USB</div>
						<div class="tabBottomLine"></div>
					</div>
					
				</td>
			</tr>
			<tr>
				<td style="padding-top:10px;">
					<div id="tabContent"></div>
					<div id="waitContainer"></div>
				</td>
			</tr>
		</table>

    <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
    </script>
		
	</div>
	
</body>
</html>
