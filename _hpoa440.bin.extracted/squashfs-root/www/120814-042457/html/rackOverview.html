<!--  (C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>HP BladeSystem Onboard Administrator</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="../css/default.css" />
  <link rel="stylesheet" type="text/css" href="../css/blue_theme.css" />
  <link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css" />
  <link rel="stylesheet" type="text/css" href="../css/widgets.css" />
  <link rel="stylesheet" type="text/css" href="../Help/stylesheets/help.css" />
  <style type="text/css">
    div.enclosureWrapper{padding:10px 10px 10px 10px;border:1px solid #000000;}
    * html div.enclosureWrapper {width:100%;}
  </style>
  <script type="text/javascript" src="../js/browser.js"></script>
  <script type="text/javascript" src="../js/helpTips.js"></script>
  <script type="text/javascript" src="../js/EnvironConstants.js"></script>
  <script type="text/javascript" src="../js/progressBarManager.js"></script>
  <script type="text/javascript" src="../js/tableManager.js"></script>
  <script type="text/javascript" src="../js/inputValidator.js"></script>
  <script type="text/javascript" src="../js/formManager.js"></script>
  <script type="text/javascript" src="../js/displayManager.js"></script>
  <script type="text/javascript" src="../js/buttonManager.js" ></script>
  <script type="text/javascript" src="../js/redrawManager.js"></script>
  <script type="text/javascript" src="../js/tabManager.js"></script>
  <script type="text/javascript" src="../js/global.js"></script>
  <script type="text/javascript" src="../js/init.js"></script>
  <script type="text/javascript" src="../js/xml.js"></script>
  <script type="text/javascript" src="../js/xslt.js"></script>
  <script type="text/javascript" src="../js/enclosure.js"></script>
  <script type="text/javascript">
var me=this;
var gPageLoaded=false;
var ourProgressBarManager=new ProgressBarManager();
var regEventHandlers=null;
var redrawManager=new RedrawManager();
var loadProgressCollector=new Object();
var loaderObject=new Object();
function loadContent(){
try{
var hpemLocal=top.mainPage.getHiddenFrame().getProxyLocal();
if(hpemLocal!=null){
top.mainPage.setMainTitle(top.getString('rackOverview')+' - '+hpemLocal.getRackName());
selectTab('rackOverview');
}else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
function selectTab(tabId){
try{
ourTabManager.toggleTabs(tabId);
setTabContent(tabId);
}catch(e){}
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function setLocationHash(encNum){
var theHash=(encNum?"#enc"+encNum:location.hash);
if(theHash!=""){
location.hash=theHash;
try{
clearLoginInputs(theHash.substring(4));
}catch(e){}
}
}
function showEnclosureSignIn(encNum){
if(getCurrentTab()!="rackOverview"){
selectTab("rackOverview");
}
setLocationHash(encNum);
}
function clearLoginInputs(encNum){
var displayMgr=new DisplayManager(null,null,'loginErrorEnc'+encNum);
displayMgr.clearErrorContainers();
clearTextbox('passwordInput'+encNum);
clearTextbox('usernameInput'+encNum);
focusTextbox('usernameInput'+encNum);
return false;
}
function checkEnter(e,encNum){
var characterCode;
try{
if(e&&e.which)
characterCode=e.which
else
characterCode=e.keyCode
if(characterCode==13){
signIn(encNum);
return false;
}else{
return true;
}
}catch(err){
return true;
}
}
function signIn(encNum){
var displayMgr=new DisplayManager(null,null,'loginErrorEnc'+encNum);
displayMgr.clearErrorContainers();
var ourInputValidator=new InputValidator('validate-login'+encNum,'loginErrorEnc'+encNum,true);
if(ourInputValidator.allInputsValidate()){
var hpemObj=top.mainPage.getHiddenFrame().getProxy(encNum);
var user=document.getElementById('usernameInput'+encNum).value;
var pass=document.getElementById('passwordInput'+encNum).value;
if(hpemObj){
toggleEnabled(false,encNum,true);
hpemObj.userLogIn(user,pass,function(result){
if(getCallSuccess(result)==true){
var formMgr=new FormManager(function(success){
if(success==true){
setTimeout('dataLoadFunction('+encNum+')',1000);
}else{
hpemObj.setIsAuthenticated(false);
toggleEnabled(true,encNum,true);
clearTextbox('passwordInput'+encNum);
focusTextbox('passwordInput'+encNum);
}
},false,'loginErrorEnc'+encNum);
formMgr.startBatch(true,true);
formMgr.queueCall(hpemObj.getEnclosureInfo);
formMgr.endBatch();
}else{
var errMsg=top.getString('invalidUserOrPass');
var errInfo=top.getCallAnalyzer().extractErrorInfo(result);
if(!(errInfo.errorType==ErrorType.UserRequest&&errInfo.errorNumber=='150')){
errMsg=top.getErrorString(errInfo.errorNumber,errInfo.errorType);
}
displayMgr.showErrors(errMsg);
toggleEnabled(true,encNum,true);
clearTextbox('passwordInput'+encNum);
focusTextbox('passwordInput'+encNum);
}
});
}
}else{
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
}
return false;
}
function dataLoadFunction(encNum,bDisableButtons){
var encContent=document.getElementById('enc'+encNum+'Content');
if(bDisableButtons){
toggleEnabled(false,encNum,true);
}
addProgressIndicator(encContent,encNum);
var updateFunction=new Function("result","updateLoadProgress(result, "+encNum+");");
loadProgressCollector['enc'+encNum]=new Object();
loadProgressCollector['enc'+encNum].objectsLoaded=0;
top.mainPage.getHiddenFrame().loadEnclosureCache(encNum,updateFunction,function(numObjects){
loadProgressCollector['enc'+encNum].objectsToLoad=numObjects;
});
}
function updateLoadProgress(result,encNum){
var currentUpdateObj=loadProgressCollector['enc'+encNum];
currentUpdateObj.objectsLoaded+=1;
var pctComplete=(currentUpdateObj.objectsLoaded/currentUpdateObj.objectsToLoad)*100;
ourProgressBarManager.updateProgressBar('prgBar'+encNum,pctComplete);
if(currentUpdateObj.objectsLoaded==currentUpdateObj.objectsToLoad){
toggleEnabled(true,0,true);
setTimeout(function(){loadLinkedEnclosure(encNum)},100);
}
}
function loadLinkedEnclosure(encNum){
var tabContent=document.getElementById('tabContent');
var hpem=top.mainPage.getHiddenFrame().getProxy(encNum);
if(hpem){
loadRackEnclosure(hpem,encNum);
}
}
function toggleEnabled(bEnabled,encNum,bAllButtons){
var buttons=new Array();
if(bAllButtons){
buttons=document.getElementsByTagName('BUTTON');
}else{
buttons.push(document.getElementById('ID_LOGON'+encNum));
buttons.push(document.getElementById('ID_CLEAR'+encNum));
}
if(bEnabled){
for(var i=0;i<buttons.length;i++){
ourButtonManager.enableButtonById(buttons[i].id);
}
}else{
for(var j=0;j<buttons.length;j++){
ourButtonManager.disableButtonById(buttons[j].id);
}
}
if(encNum>0){
var txtUser=document.getElementById("usernameInput"+encNum);
var txtPwd=document.getElementById("passwordInput"+encNum);
if(txtUser){
txtUser.disabled=!bEnabled;
}
if(txtPwd){
txtPwd.disabled=!bEnabled;
}
}
}
function addProgressIndicator(contentElement,encNum){
var processor=new XsltProcessor('../Templates/progressBar.xsl');
processor.addParameter('processName',top.getString('loadingEncInfo'));
processor.addParameter('complete',top.getString('complete'));
processor.addParameter('barId','prgBar'+encNum);
processor.addParameter('align','');
processor.addParameter('width','480');
contentElement.innerHTML=processor.getOutput();
ourProgressBarManager.init();
}
function setTabContent(tabId){
document.getElementById('tabContent').innerHTML='';
switch(tabId){
case "rackPt":
loadRackPowerThermal();
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_RACK_POWER_THERMAL");
break;
case "rackOverview":
loadEnclosures();
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_RACK_OVERVIEW");
default:
break;
}
}
function loadEnclosures(){
if(loaderObject.loading==true){
loaderObject.requests++;
return;
}
if(regEventHandlers==null){
regEventHandlers=new Array();
}
var hpems=top.getTopology().getProxies();
var displayMgr=new DisplayManager("tabContent","waitContainer");
loaderObject.totalEnclosures=hpems.length;
loaderObject.totalLoaded=0;
loaderObject.requests=0;
loaderObject.loading=true;
displayMgr.createWaitContainer(top.getString('loading...'));
displayMgr.showWaitScreen();
var processor=new XsltProcessor('../Templates/rackOverview.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('enclosureList',top.getTopology().getMaxEnclosureList());
processor.addParameter('maxConnectionsExceeded',top.getTopology().getMaxConnectionsExceeded());
document.getElementById('tabContent').innerHTML=processor.getOutput();
for(var i=0;i<hpems.length;i++){
loadRackEnclosure(hpems[i],hpems[i].getEnclosureNumber());
}
}
function allLoadedHandler(){
if(loaderObject.loading==true){
loaderObject.totalLoaded++;
if(loaderObject.totalLoaded>=loaderObject.totalEnclosures){
loaderObject.loading=false;
if(loaderObject.requests>0){
loadEnclosures();
}else{
var hpems=top.getTopology().getProxies();
for(var j=regEventHandlers.length-1;j>=0;j--){
var found=false;
for(var i=0;i<hpems.length;i++){
if(regEventHandlers[j].uuid==hpems[i].getUuid()){
found=true;
break;
}
}
if(!found){
top.logEvent("Rack Overview: Deleting event handlers.",regEventHandlers[j].encNum,1,4);
regEventHandlers.splice(j,1);
}
}
var displayMgr=new DisplayManager("tabContent","waitContainer");
displayMgr.showMainScreen();
if(!gPageLoaded){
setLocationHash();
gPageLoaded=true;
}
reconcilePage();
}
}
}
};
function addEventHandlers(hpoa){
var frontViewEvents=[
'EVENT_BLADE_INFO',
'EVENT_BLADE_UID',
'EVENT_BLADE_STATUS',
'EVENT_BLADE_INSERT_COMPLETED',
'EVENT_BLADE_POWER_STATE',
'EVENT_BLADE_MP_INFO',
'EVENT_BLADE_GRP_CAP_TIMEOUT',
'EVENT_ILO_READY',
'EVENT_ILO_DEAD',
'EVENT_ILO_ALIVE',
'EVENT_ILO_HAS_IPADDRESS',
'EVENT_SBL_DOMAIN_INFO_CHANGED'
];
var rearViewEvents=[
'EVENT_FAN_STATUS',
'EVENT_FAN_INSERTED',
'EVENT_FAN_REMOVED',
'EVENT_INTERCONNECT_INSERTED',
'EVENT_INTERCONNECT_REMOVED',
'EVENT_INTERCONNECT_INFO',
'EVENT_INTERCONNECT_STATUS',
'EVENT_INTERCONNECT_UID'
];
var encInfoEvents=[
'EVENT_ENC_STATUS',
'EVENT_ENC_UID',
'EVENT_ENC_INFO',
'EVENT_ENC_NAMES',
'EVENT_OA_VCM',
'EVENT_INTERCONNECT_INFO',
'EVENT_VCM_FQDN_INFO_REFRESH'
];
var enclosureType=hpoa.getEnclosureType();
if(enclosureType==EnclosureTypes.c3000){
frontViewEvents.push('EVENT_OA_STATUS');
frontViewEvents.push('EVENT_OA_UID');
frontViewEvents.push('EVENT_MEDIA_INSERTED');
frontViewEvents.push('EVENT_MEDIA_REMOVED');
rearViewEvents.push('EVENT_PS_INSERTED');
rearViewEvents.push('EVENT_PS_REMOVED');
rearViewEvents.push('EVENT_PS_INFO');
rearViewEvents.push('EVENT_PS_STATUS');
}else{
rearViewEvents.push('EVENT_OA_STATUS');
rearViewEvents.push('EVENT_OA_UID');
frontViewEvents.push('EVENT_PS_INSERTED');
frontViewEvents.push('EVENT_PS_REMOVED');
frontViewEvents.push('EVENT_PS_INFO');
frontViewEvents.push('EVENT_PS_STATUS');
}
var encNum=hpoa.getEnclosureNumber();
var uuid=hpoa.getUuid();
for(var index in regEventHandlers){
if(regEventHandlers[index].uuid==uuid){
if(regEventHandlers[index].encNum==encNum&&hpoa.getTotalEventListeners()>=regEventHandlers[index].funcs.length){
top.logEvent("Rack Overview: Event handlers already registered.",encNum,1,2);
return;
}else{
top.logEvent("Rack Overview: Event handlers need to be removed.",encNum,1,4);
removeEventHandlers(hpoa);
break;
}
}
}
var funcCollection=new Object();
funcCollection.encNum=encNum;
funcCollection.uuid=uuid;
funcCollection.funcs=new Array();
funcCollection.funcs[0]=new Function("result","frontViewChanged("+encNum+", result);");
hpoa.registerEventHandler(funcCollection.funcs[0],frontViewEvents);
redrawManager.addRedrawObject(10000,funcCollection.funcs[0],"frontView"+hpoa.getUuid());
funcCollection.funcs[1]=new Function("result","rearViewChanged("+encNum+", result);");
hpoa.registerEventHandler(funcCollection.funcs[1],rearViewEvents);
funcCollection.funcs[2]=new Function("result","enclosureInfoChanged("+encNum+", result);");
hpoa.registerEventHandler(funcCollection.funcs[2],encInfoEvents);
funcCollection.funcs[3]=new Function("result","lcdStatusChanged("+encNum+", result);");
hpoa.registerEventHandler(funcCollection.funcs[3],['EVENT_LCD_STATUS']);
regEventHandlers.push(funcCollection);
}
function removeEventHandlers(hpoa){
var encNum=hpoa.getEnclosureNumber();
var uuid=hpoa.getUuid();
redrawManager.removeRedrawObject("frontView"+uuid);
for(var i=0;i<regEventHandlers.length;i++){
if(regEventHandlers[i].uuid==uuid){
var funcCol=regEventHandlers[i];
try{
for(var j=0;j<funcCol.funcs.length;j++){
hpoa.removeRegisteredHandler(funcCol.funcs[j]);
}
regEventHandlers.splice(i,1);
break;
}catch(e){
top.logEvent(["Rack Overview: Error removing event handler.",e.message],encNum,1,5);
}
}
}
}
function addEnclosure(encNum,uuid){
var hpem=top.getTopology().getProxy(uuid);
if(hpem!=null){
loadRackEnclosure(hpem,encNum);
}
}
function removeEnclosure(encNum){
var contentTarget=document.getElementById('enc'+encNum+'rackContainer');
if(contentTarget){
contentTarget.style.display='none';
contentTarget.innerHTML='';
}
var lostHpem=top.getTopology().getProxy(encNum,true);
if(lostHpem!=null){
removeEventHandlers(lostHpem);
}
}
function moveEnclosure(prevEncNum,newEncNum,uuid){
removeEnclosure(prevEncNum);
addEnclosure(newEncNum,uuid);
}
function signOutEnclosure(encNum){
var hpem=top.getTopology().getProxy(encNum);
if(hpem){
hpem.userLogOut(true,function(){
removeEventHandlers(hpem);
loadRackEnclosure(hpem,encNum);
try{top.mainPage.getHiddenFrame().refreshNavTree();}catch(e){}
try{top.mainPage.getLeftSideFrame().loadSystemStatus();}catch(e){}
});
}
}
function loadRackEnclosure(hpem,encNum){
var processor=new XsltProcessor('../Templates/rackOverviewEnclosure.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('encNum',encNum);
processor.addParameter('encType',hpem.getEnclosureType());
processor.addParameter('isTower',hpem.getIsTower());
processor.addParameter('enclosureName',hpem.getEnclosureName());
processor.addParameter('isAuthenticated',(''+hpem.getIsAuthenticated()));
processor.addParameter('isTfaEnabled',(''+hpem.getTwoFactorEnabled()));
processor.addParameter('isLoaded',(''+hpem.getIsLoaded()));
processor.addParameter('isLocal',(''+hpem.getIsLocal()));
var contentTarget=document.getElementById('enc'+encNum+'rackContainer');
if(contentTarget){
contentTarget.innerHTML=processor.getOutput();
contentTarget.style.display='block';
}
if(hpem.getEventsOn()==true&&hpem.getIsAuthenticated()==true&&hpem.getIsLoaded()==true){
loadFrontView(hpem,encNum);
loadRearView(hpem,encNum);
loadEnclosureInfo(hpem,encNum);
loadRackInfo(hpem,encNum);
addEventHandlers(hpem);
}
if(loaderObject.loading==true){
allLoadedHandler();
}else{
reconcilePage();
}
}
function loadFrontView(hpem,encNum){
var frontViewHtml=transformFrontView(hpem,encNum);
var frontViewContainer=document.getElementById('enclosureFrontView'+encNum);
if(frontViewContainer&&frontViewHtml!=''){
frontViewContainer.innerHTML=frontViewHtml;
}
}
function loadRearView(hpem,encNum){
var rearViewHtml=transformRearView(hpem,encNum);
var rearViewContainer=document.getElementById('enclosureRearView'+encNum);
if(rearViewContainer&&rearViewHtml!=''){
rearViewContainer.innerHTML=rearViewHtml;
}
}
function loadEnclosureInfo(hpem,encNum){
var hasMultiple=(top.getTopology().getProxies().length>1);
hpem.getOaVcmMode(function(oaVcmInfo){
var processor=new XsltProcessor('../Templates/rackOverviewEncInfo.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('encNum',encNum);
processor.addParameter('encType',hpem.getEnclosureType());
processor.addParameter('isTower',hpem.getIsTower());
processor.addParameter('isTfaEnabled',(''+hpem.getTwoFactorEnabled()));
processor.addParameter('hasMultiple',hasMultiple);
processor.addParameter('oaStatusDoc',hpem.getOaStatusDOM());
processor.addParameter('enclosureInfoDoc',hpem.getEnclosureInfo());
processor.addParameter('enclosureStatusDoc',hpem.getEnclosureStatus());
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('serviceUserOaAccess',hpem.getUserOaPermission());
processor.addParameter('vcmInfoDoc',oaVcmInfo);
processor.addParameter('activeOaNetworkInfo',hpem.getOaNetworkInfoByMode(ACTIVE(),null,false));
processor.addParameter('lcdStatusDoc',hpem.getLcdStatus());
processor.addParameter('lcdInfoDoc',hpem.getLcdInfo());
processor.addParameter('isLocal',(hasMultiple?hpem.getIsLocal():false));
var enclosureInfoContainer=document.getElementById('enclosureInfoView'+encNum);
if(enclosureInfoContainer){
enclosureInfoContainer.innerHTML=processor.getOutput();
}
},true);
}
function loadRackInfo(hpem,encNum){
var processor=new XsltProcessor('../Templates/rackOverviewRackInfo.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('enclosureInfoDoc',hpem.getEnclosureInfo());
var rackInfoContainer=document.getElementById('rackInfoView'+encNum);
if(rackInfoContainer){
rackInfoContainer.innerHTML=processor.getOutput();
}
}
function frontViewChanged(encNum,result){
var hpem=top.mainPage.getHiddenFrame().getProxy(encNum);
if(hpem){
var redrawId="frontView"+hpem.getUuid();
if(redrawManager.getIsSleeping(redrawId)){
redrawManager.addRequest(redrawId,result);
}else{
loadFrontView(hpem,encNum);
reconcilePage();
redrawManager.startSleeping(redrawId);
}
}
}
function rearViewChanged(encNum,result){
var hpem=top.mainPage.getHiddenFrame().getProxy(encNum);
if(hpem){
loadRearView(hpem,encNum);
reconcilePage();
}
}
function lcdStatusChanged(encNum,result){
var hpem=top.mainPage.getHiddenFrame().getProxy(encNum);
var lcdImage=document.getElementById('imgLCD'+encNum);
if(hpem&&lcdImage){
var encUid=getElementValueXpath(hpem.getEnclosureStatus(),'//hpoa:uid');
var partNo=getElementValueXpath(hpem.getLcdInfo(),'//hpoa:partNumber');
var imgType=(partNo==''||partNo=='415839-001'?"":"_vert");
var img="";
if(encUid=='UID_ON'){
img="/120814-042457/images/enclosure_lcd_uid"+imgType+".gif";
}else{
var lcdHealth=getElementValueXpath(result,'//hpoa:lcdSetupHealth');
switch(lcdHealth){
case 'LCD_SETUP_HEALTH_OK':
img="/120814-042457/images/enclosure_lcd_normal"+imgType+".gif";
break;
case 'LCD_SETUP_HEALTH_DEGRADED':
case 'LCD_SETUP_HEALTH_FAILED':
case 'LCD_SETUP_HEALTH_INFORMATIONAL':
img="/120814-042457/images/enclosure_lcd_degraded"+imgType+".gif";
break;
case 'LCD_SETUP_HEALTH_UNKNOWN':
default:
img="/120814-042457/images/enclosure_lcd"+imgType+".gif";
}
}
lcdImage.src=img;
}
}
function enclosureInfoChanged(encNum,result){
var eventName=getElementValueXpath(result,'//hpoa:event');
var hpem=top.mainPage.getHiddenFrame().getProxy(encNum);
if(hpem){
loadEnclosureInfo(hpem,encNum);
loadRackInfo(hpem,encNum);
}
if(eventName=='EVENT_ENC_UID'){
var linkNicUid=document.getElementById('enc'+encNum+'linkNic');
if(linkNicUid){
var uidState=getElementValueXpath(result,'//hpoa:uid');
if(uidState==UID_OFF()){
linkNicUid.src='/120814-042457/images/uid_small_off.gif';
}else{
linkNicUid.src='/120814-042457/images/uid_small_on.gif';
}
}
}else if(eventName=='EVENT_ENC_NAMES'||eventName=='EVENT_ENC_INFO'){
var encNameLabel=document.getElementById('encNameLabel'+encNum);
if(encNameLabel){
encNameLabel.innerHTML=getElementValueXpath(result,'//hpoa:enclosureName');
}
}
}
function toggleEnclosureUid(encNum){
var hpem=top.getTopology().getProxy(encNum);
var state=UID_CMD_ON();
var uidLabel=document.getElementById('uidLabel'+encNum);
if(uidLabel&&hpem){
top.getTopology().setSelectedEnclosureNumber(encNum);
window.setTimeout(function(){hpem.setEnclosureUid(UID_CMD_TOGGLE(),function(){})},500);
}
}
function loadRackPowerThermal(){
var hpems=top.mainPage.getHiddenFrame().getProxies();
var formMgr=new FormManager(function(success){
if(success){
document.getElementById('tabContent').removeChild(document.getElementById('tabContent').childNodes[0]);
var rackVaCurrent=0;
var rackVaMax=0;
var rackBtuCurrent=0;
var rackBtuMax=0;
for(var i=0;i<hpems.length;i++){
if(hpems[i].getIsLoaded()){
var powerSubsystemInfo=hpems[i].getPowerSubsystemInfo();
var vaCurrent=parseInt(getElementValueXpath(powerSubsystemInfo,'//hpoa:inputPower'));
var vaMax=parseInt(getElementValueXpath(powerSubsystemInfo,'//hpoa:inputPowerCapacity'));
if(isNaN(vaCurrent)||vaCurrent==0){
vaCurrent=parseInt(getElementValueXpath(powerSubsystemInfo,'//hpoa:inputPowerVa'));
}
if(isNaN(vaMax)||vaMax==0){
vaMax=parseInt(getElementValueXpath(powerSubsystemInfo,'//hpoa:inputPowerCapacityVa'));
}
rackVaCurrent+=vaCurrent;
rackVaMax+=vaMax;
}
}
rackBtuCurrent=parseInt(rackVaCurrent*(VA_TO_BTU()));
rackBtuMax=parseInt(rackVaMax*(VA_TO_BTU()));
var processor=new XsltProcessor('../Templates/rackCooling.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('rackBtuCurrent',rackBtuCurrent);
processor.addParameter('rackBtuMax',rackBtuMax);
var rackCoolingDiv=document.createElement('div');
rackCoolingDiv.innerHTML=processor.getOutput();
document.getElementById('tabContent').appendChild(rackCoolingDiv);
for(var j=0;j<hpems.length;j++){
if(hpems[j].getIsLoaded()){
processor=new XsltProcessor('../Templates/powerThermalRackEnc.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('enclosureInfoDoc',hpems[j].getEnclosureInfo());
processor.addParameter('enclosureStatusDoc',hpems[j].getEnclosureStatus());
processor.addParameter('encNum',hpems[j].getEnclosureNumber());
processor.addParameter('powerSubsystemInfoDoc',hpems[j].getPowerSubsystemInfo());
processor.addParameter('powerConfigInfoDoc',hpems[j].getPowerConfigInfo());
processor.addParameter('powerCapConfigDoc',hpems[j].getPowerCapConfig());
processor.addParameter('thermalSubsystemInfoDoc',hpems[j].getThermalSubsystemInfo());
processor.addParameter('enclosureThermalsDoc',hpems[j].getEnclosureThermalInfo());
processor.addParameter('isAuthenticated',(''+hpems[j].getIsAuthenticated()));
processor.addParameter('isLoaded',(''+hpems[j].getIsLoaded()));
processor.addParameter('isLocal',(''+hpems[j].getIsLocal()));
processor.addParameter('enclosureName',hpems[j].getEnclosureName());
var oaInfo=hpems[j].getOaInfo(hpems[j].getOaBayNumber("ACTIVE"));
if(oaInfo){
var fwVersion=getElementValueXpath(oaInfo,'//hpoa:fwVersion');
}
if(fwVersion>="2.00"){
processor.addParameter('enclosureType',hpems[j].getEnclosureType());
}
var encDiv=document.createElement('div');
encDiv.setAttribute('encNum',hpems[j].getEnclosureNumber());
encDiv.innerHTML=processor.getOutput();
document.getElementById('tabContent').appendChild(encDiv);
}
}
reconcilePage();
}else{
displayContentFailed('tabContent',formMgr.getErrorsArray());
}
},false,'','tabContent');
formMgr.startBatch(true);
for(var k=0;k<hpems.length;k++){
if(hpems[k].getIsLoaded()){
formMgr.queueCall(hpems[k].getPowerSubsystemInfo);
formMgr.queueCall(hpems[k].getEnclosureThermalInfo);
formMgr.queueCall(hpems[k].getPowerConfigInfo);
formMgr.queueCall(hpems[k].getPowerCapConfig);
}
}
formMgr.endBatch();
}
function toggleEnclosureVisible(encId,expandImage){
var enclosure=document.getElementById(encId);
var enclosurePadding=document.getElementById(encId+"Padding");
if(enclosure){
if(enclosure.style.display=='none'){
enclosure.style.display='block';
expandImage.src='/120814-042457/images/win_shrink.gif';
enclosurePadding.style.display='none';
}else{
enclosure.style.display='none';
expandImage.src='/120814-042457/images/win_expand.gif';
enclosurePadding.style.display='block';
}
}
}
function selectDevice(bayNumber,type,encNum){
top.mainPage.getHiddenFrame().selectDevice(bayNumber,type,encNum,true);
}
function pageUnload(){
redrawManager.reset();
if(regEventHandlers==null){
return;
}
var hpems=top.getTopology().getProxies();
for(var i=0;i<hpems.length;i++){
removeEventHandlers(hpems[i]);
}
regEventHandlers=null;
document.body.innerHTML="";
}
function refreshTopology(){
top.refreshTopology();
}
  </script>

</head>
<body id="rackOverviewBody" onload="loadContent();" onunload="pageUnload();">
  <!-- standard helptooltip element -->
  <div id="helpTooltip" class="popupSmallWrapper">
    <div class="popupSmallTitle"><img alt="" src="/120814-042457/images/icons/help-popup.gif" /></div>
    <div id="tooltipText" class="helpPopupSmallBody" style="color:#000;"></div>
  </div>
  <div id="tooltip" class="popupSmallWrapper" onclick="killToolTip();" onmouseover="clearTooltipTimer();" onmouseout="updateTooltipTimer();">
    <div class="popupSmallBody" style="background-color:#fff;padding:0px;"></div>
  </div>
  <table cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
      <td valign="bottom">
        <div class="tabSet" id="tabSet">
          <div class="tabOff" tabid="rackOverview" id="rackOverview">
            <script type="text/javascript">document.write(top.getString('rackTopology'));</script>
          </div>
          <div class="tabOff" tabid="rackPt" id="rackPt">
            <script type="text/javascript">document.write(top.getString('rackPowerAndThermal'));</script>
          </div>
          <div class="tabBottomLine">
          </div>
        </div>
      </td>
    </tr>
    <tr>
      <td style="padding-top: 10px;">
        <div id="tabContent">
        </div>
        <div id="waitContainer" class="waitContainer">
        </div>
      </td>
    </tr>
  </table>

  <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
  </script>

</body>
</html>
