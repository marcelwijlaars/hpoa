<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<link rel="stylesheet" type="text/css" href="../css/widgets.css">
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
function loadContent(){
top.mainPage.setMainTitle(top.getString('enclosurePowerAllocation'));
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor('../Templates/DevicePowerUsage.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('powerSubsystemInfoDoc',hpem.getPowerSubsystemInfo());
processor.addParameter('powerConfigInfoDoc',hpem.getPowerConfigInfo());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
hpem.registerEventHandler(handleEvent,['EVENT_POWER_INFO','EVENT_PS_SUBSYSTEM_STATUS']);
}
else{
displayContentFailed('bodyContent',formMgr.getErrorsArray());
}
reconcilePage();
});
formMgr.startBatch(true);
formMgr.queueCall(hpem.getPowerSubsystemInfo);
formMgr.queueCall(hpem.getPowerConfigInfo);
formMgr.endBatch();
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_DEVICE_POWER_USAGE");
}
else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('bodyContent',[e.message]);
}
}
function toggleTableVisible(divId,img){
var tableWrapper=document.getElementById(divId);
if(tableWrapper!=null){
if(tableWrapper.style.display=='none'){
tableWrapper.style.display='block';
img.src='/120814-042457/images/win_shrink.gif';
}
else{
img.src='/120814-042457/images/win_expand.gif';
tableWrapper.style.display='none';
}
}
}
function selectDevice(bayNumber,type){
top.mainPage.getHiddenFrame().selectDevice(bayNumber,type,encNum,true);
}
function displayTotalPower(){
var bladePower=getPowerValue('blade');
document.getElementById('bladePowerConsumed').innerHTML=bladePower;
var fanPower=getPowerValue('fan');
document.getElementById('fanPowerConsumed').innerHTML=fanPower;
}
function getPowerValue(deviceType){
var powerValue=0;
var divCollection=document.getElementsByTagName('div');
for(var i=0;i<divCollection.length;i++){
if(divCollection[i].getAttribute('type')&&divCollection[i].getAttribute('type')==deviceType){
if(!isNaN(divCollection[i].innerHTML)){
powerValue+=parseInt(divCollection[i].innerHTML);
}
}
}
return powerValue;
}
function handleEvent(result){
var processor=new XsltProcessor('../Templates/DevicePowerUsage.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('powerSubsystemInfoDoc',hpem.getPowerSubsystemInfo());
processor.addParameter('powerConfigInfoDoc',hpem.getPowerConfigInfo());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
reconcilePage();
}
function refreshPage(){
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor('../Templates/DevicePowerUsage.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('powerSubsystemInfoDoc',hpem.getPowerSubsystemInfo());
processor.addParameter('powerConfigInfoDoc',hpem.getPowerConfigInfo());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
reconcilePage();
}
else{
displayContentFailed('bodyContent',formMgr.getErrorsArray());
}
});
formMgr.startBatch(true,true);
formMgr.queueCall(hpem.getPowerSubsystemInfo);
formMgr.queueCall(hpem.getPowerConfigInfo);
formMgr.endBatch();
}
	</script>
</head>
<body style="margin:10px;" onload="loadContent();">
    <div id="bodyContent"></div>
</body>
</html>
