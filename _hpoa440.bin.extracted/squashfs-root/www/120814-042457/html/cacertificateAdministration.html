<!--  (C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css"/>
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css"/>
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css"/>
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/batchManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript">
var emNum;
var encNum;
var hpem=null;
function loadContent(){
top.mainPage.setMainTitle(top.getString('twoFactorSecurity'));
try{
emNum=parseInt(getSearchValue(location.search,'emNum'));
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
ourTabManager.toggleTabs('TwoFactorSettings');
setTabContent('TwoFactorSettings');
hpem.registerEventHandler(certificateAdded,['EVENT_TFA_CA_CERT_ADDED']);
hpem.registerEventHandler(certificateRemoved,['EVENT_TFA_CA_CERT_REMOVED']);
}else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function setTabContent(tabId){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextId=contentTab.getAttribute('contextId');
top.mainPage.getHelpLauncher().setCurrentTopic(contextId);
if(hpem==null){
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
return;
}
try{
if(contentLocation=='../Templates/twoFactorSettings.xsl'){
var formMgr=new FormManager(function(success){
if(success){
var tfa=hpem.gettwofactorflag();
var crl=hpem.getcertificaterevocationflag();
var subaltname=hpem.getsubjectaltnameflag();
var processor=new XsltProcessor("../Templates/twoFactorSettings.xsl");
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('twofactor',tfa);
processor.addParameter('certRevocation',crl);
processor.addParameter('subaltname',subaltname);
document.getElementById('tabContent').innerHTML=processor.getOutput();
reconcilePage();
}else{
displayContentFailed('tabContent',formMgr.getErrorsArray());
}
},false,'errorDisplay','tabContent','waitContainer');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getTwoFactorAuthenticationConf);
formMgr.endBatch();
}else{
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor(contentLocation);
var certsdoc=hpem.getCaCertificatesInfo();
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('certsdoc',certsdoc);
document.getElementById('tabContent').innerHTML=processor.getOutput();
reconcilePage();
},false,'errorDisplay','tabContent','waitContainer');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getCaCertificatesInfo);
formMgr.endBatch();
}
}catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
function uploadCertificate(){
var confirmCreate=top.getString('caCertWillBeUploaded')+'\n'+top.getString('areYouSure');
var certContent=document.getElementById('certificateContents').value;
if(certContent!=''){
if(confirm(confirmCreate)){
var formMgr=new FormManager(function(){
if(success){
formMgr.displayManager.showWaitScreen();
}
},false,'errorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('completingCertificateUpload'));
formMgr.startBatch();
formMgr.queueCall(hpem.addCaCertificate,[certContent]);
formMgr.endBatch();
}
}else{
alert(top.getString('pleaseEnterCertContents'),AlertMsgTypes.Warning);
}
}
function downloadCertificate(){
var confirmCreate=top.getString('caCertWillBeUploaded')+'\n'+top.getString('areYouSure');
var certUrl=document.getElementById('certUrl').value;
if(certUrl!=''){
if(confirm(confirmCreate)){
var formMgr=new FormManager(function(){
if(success){
formMgr.displayManager.showWaitScreen();
}
},false,'errorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('downloadingCertificate'));
formMgr.startBatch();
formMgr.queueCall(hpem.downloadCaCertificate,[certUrl]);
formMgr.endBatch();
}
}else{
alert(top.getString('pleaseProvideValidUrl'),AlertMsgTypes.Warning);
}
}
function certificateAdded(result){
if(getCurrentTab()=='CACertupload'){
ourTabManager.toggleTabs('CACertinfo');
setTabContent('CACertinfo');
}
}
function certificateRemoved(result){
ourTabManager.toggleTabs('CACertinfo');
setTabContent('CACertinfo');
}
function unmap(sha1){
var newfingerprint=sha1;
var confirmCreate=top.getString('reallyDeleteCaCertificate');
if(newfingerprint!=''){
if(confirm(confirmCreate)){
var formMgr=new FormManager(function(){
if(success){
formMgr.displayManager.showWaitScreen();
}
},false,'errorDisplay','tabContent','waitContainer');
var temp=new Array();
temp=newfingerprint.split(':');
var fingerprint='';
for(var i=0;i<temp.length;i++)
fingerprint=fingerprint+temp[i];
fingerprint=fingerprint.toString();
fingerprint=fingerprint.toLowerCase();
formMgr.createWaitContainer(top.getString('removingCertificate'));
formMgr.startBatch();
formMgr.queueCall(hpem.removeCaCertificate,[fingerprint]);
formMgr.endBatch();
}
}else{
alert(top.getString('noFingerPrintPresent'),AlertMsgTypes.Warning);
}
}
function tfa(){
var tfa=parseBool(hpem.gettwofactorflag());
var enableTwoFactor=document.getElementById('chkTwoFactorEnabled').checked;
var enableCrl=document.getElementById('chkCertRevocation').checked;
var subjectAltName=document.getElementById('optSAN').checked;
var resetExpected=(tfa!=enableTwoFactor);
var confirmMsg=top.getString('twoFactorSettingsWillBeApplied')+'\n';
if(resetExpected){
confirmMsg+=top.getString('oaWillBeReset')+'\n';
}
confirmMsg+=top.getString('areYouSure');
if(confirm(confirmMsg)){
var formMgr=new FormManager(function(success){
if(success&&resetExpected){
formMgr.createWaitContainer(top.getString('settingsAppliedPleaseWait'));
formMgr.displayManager.showWaitScreen();
}
},false,'errorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('applyingTwoFactorSettings'));
formMgr.startBatch();
formMgr.queueCall(hpem.enableTwoFactorAuthentication,[enableTwoFactor,enableCrl,subjectAltName]);
formMgr.endBatch();
}
}
function deRegisterHandlers(){
if(hpem!=null){
hpem.removeRegisteredHandler(certificateAdded);
hpem.removeRegisteredHandler(certificateRemoved);
}
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="deRegisterHandlers();">
    <div id="bodyContent">
  
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
      <tr>
        <td valign="bottom">
            <div class="tabSet" id="tabSet">
              <div class="tabOff"  tabid="TwoFactorSettings" contextId="FORM_TWO_FACTOR_SETTINGS" id="TwoFactorSettings" contentLocation="../Templates/twoFactorSettings.xsl"><script type="text/javascript">document.write(top.getString('settings'));</script></div>
                
              <div class="tabOff" tabid="CACertinfo" contextId="FORM_CA_CERTIFICATE_INFO" id="CACertinfo" contentLocation="../Templates/CAcertificateinfo.xsl"><script type="text/javascript">document.write(top.getString('certificateInformation'));</script></div>
              <div class="tabOff" tabid="CACertupload" contextId="FORM_CA_CERTIFICATE_UPLOAD" id="CACertupload" contentLocation="../Templates/CAcertificateupload.xsl"><script type="text/javascript">document.write(top.getString('certificateUpload'));</script></div>
              
            <div class="tabBottomLine"></div>
          </div>
          
        </td>
      </tr>
      <tr>
        <td style="padding-top:10px;">
          <div id="tabContent"></div>
          <div id="waitContainer" class="waitContainer"></div>
        </td>
      </tr>
    </table>

    <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
    </script>
    
  </div>
</body>
</html>
