<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/tableManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
var displayMgr=null;
var performingCertAction=false;
var hpSimCertEventArrived=false;
function initPage(){
top.mainPage.setMainTitle(top.getString('hpSimIntegration'));
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
hpem.registerEventHandler(hpSimInfoChanged,['EVENT_HPSIM_TRUST_MODE_CHANGED','EVENT_HPSIM_CERTIFICATE_ADDED','EVENT_HPSIM_CERTIFICATE_REMOVED','EVENT_HPSIM_XENAME_REMOVED','EVENT_HPSIM_XENAME_ADDED']);
selectTab('simSettings');
}else{
displayContentFailed('tabContent',[top.getString("noOnboardAdmin")]);
}
}
function selectTab(tabId){
ourTabManager.toggleTabs(tabId);
setTabContent(tabId);
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function setTabContent(tabId){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextId=contentTab.getAttribute('contextId');
top.mainPage.getHelpLauncher().setCurrentTopic(contextId);
if(contentLocation){
loadCertificateInfo(contentLocation,tabId);
}
}
function loadCertificateInfo(contentLocation,tabId){
if(tabId=='certInfo'||tabId=='simSettings'){
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('hpSimInfoDoc',formMgr.getDataByCallIndex(0));
document.getElementById('tabContent').innerHTML=processor.getOutput();
}else{
displayContentFailed('tabContent',formMgr.getErrorsArray());
}
reconcilePage();
},true,'','tabContent');
with(formMgr){
startBatch(true);
queueCall(hpem.getHpSimInfo);
endBatch();
}
}else{
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
document.getElementById('tabContent').innerHTML=processor.getOutput();
reconcilePage();
}
}
function uploadCertificate(){
var certText=document.getElementById('certificateContents').value;
hpSimCertEventArrived=false;
if(certText!=''){
performingCertAction=true;
var formMgr=new FormManager(function(success){
if(success){
if(!hpSimCertEventArrived){
formMgr.displayManager.showWaitScreen();
}
}
else{
performingCertAction=false;
}
},false,'errorDisplay','tabContent');
formMgr.createWaitContainer(top.getString('completingCertificateUpload'));
formMgr.startBatch();
formMgr.queueCall(hpem.addHpSimCertificate,[certText]);
formMgr.endBatch();
}
else{
alert(top.getString('mustEnterCertificate'));
}
}
function downloadCertificate(){
var certificateUrl=document.getElementById('certUrl').value;
hpSimCertEventArrived=false;
if(certificateUrl!=''){
performingCertAction=true;
var formMgr=new FormManager(function(success){
if(success){
if(!hpSimCertEventArrived){
formMgr.displayManager.showWaitScreen();
}
}
else{
performingCertAction=false;
}
},false,'errorDisplay','tabContent');
formMgr.createWaitContainer(top.getString('completingCertificateDownload'));
formMgr.startBatch();
formMgr.queueCall(hpem.downloadHpSimCertificate,[certificateUrl]);
formMgr.endBatch();
}
else{
alert(top.getString('mustEnterUrl'));
}
}
function removeCertificate(commonName,fingerPrint){
var confirmString=top.getString('reallyRemoveCertificate');
if(confirm(confirmString)){
if(fingerPrint!=''){
hpSimCertEventArrived=false;
performingCertAction=true;
var formMgr=new FormManager(function(success){
if(success){
if(!hpSimCertEventArrived){
formMgr.displayManager.showWaitScreen();
}
}
else{
performingCertAction=false;
}
},false,'removeCertErrorDisplay','tabContent');
formMgr.createWaitContainer(top.getString('completingCertificateRemoval'));
formMgr.startBatch();
formMgr.queueCall(hpem.removeHpSimCertificate,[commonName]);
formMgr.endBatch();
}
else{
alert(top.getString('invalidOrEmptyCertificate'));
}
}
}
function setTrustMode(){
var trustModeSelect=document.getElementById('simTrustMode');
if(trustModeSelect){
var trustMode=trustModeSelect.options[trustModeSelect.selectedIndex].value;
var formMgr=new FormManager(null,false,'trustModeErrorDisplay','tabContent');
formMgr.createWaitContainer(top.getString('completingHpSimTrustMode'));
formMgr.startBatch();
formMgr.queueCall(hpem.setHpSimTrustMode,[trustMode]);
formMgr.endBatch();
}
}
function hpSimInfoChanged(result){
hpSimCertEventArrived=true;
if(getCurrentTab()=='certInfo'||getCurrentTab()=='simSettings'){
selectTab(getCurrentTab());
}
else if(getCurrentTab()=='certUpload'&&performingCertAction){
selectTab('certInfo');
performingCertAction=false;
}
}
function removeXeName(name){
var confirmString=top.getString('areYouSureRemoveTrustedSrv');
if(confirm(confirmString)){
var formMgr=new FormManager(null,false,'xeNameErrorDisplay','tabContent');
formMgr.createWaitContainer(top.getString('removingHPSIMXE'));
formMgr.startBatch();
formMgr.queueCall(hpem.removeHpSimXeName,[name]);
formMgr.endBatch();
}
}
function addXeName(){
var formMgr=new FormManager(null,false,'xeNameAddErrorDisplay','tabContent');
formMgr.createWaitContainer(top.getString('addingHPSIMXE'));
formMgr.startBatch();
var xeNameInput=document.getElementById('xeNameAdd');
if(xeNameInput&&xeNameInput.value!=''){
formMgr.queueCall(hpem.addHpSimXeName,[xeNameInput.value]);
}
formMgr.endBatch();
}
function deRegisterHandlers(){
try{
hpem.removeRegisteredHandler(hpSimInfoChanged);
}
catch(e){}
}
</script>

</head>
<body class="body-padded" onload="initPage();" onunload="deRegisterHandlers();">
    
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
		<tr>
			<td valign="bottom">
				<div class="tabSet" id="tabSet">
					<div class="tabOff" tabid="simSettings" contextId="FORM_HP_SIM_SETTINGS" id="simSettings" contentLocation="../Templates/hpSimSettings.xsl"><script type="text/javascript">document.write(top.getString('settings'));</script></div>
					<div class="tabOff" tabid="certInfo" contextId="FORM_HP_SIM_INFO" id="certInfo" contentLocation="../Templates/hpSimCertificateInformation.xsl"><script type="text/javascript">document.write(top.getString('certificateInformation'));</script></div>
					<div class="tabOff" tabid="certUpload" contextId="FORM_HP_SIM_CERTIFICATE_UPLOAD" id="certUpload" contentLocation="../Templates/hpSimCertUpload.xsl"><script type="text/javascript">document.write(top.getString('certificateUpload'));</script></div>
					<div class="tabBottomLine"></div>
				</div>
			</td>
		</tr>
		<tr>
			<td style="padding-top:10px;">
				<div id="tabContent"></div>
				<div id="waitContainer"></div>
			</td>
		</tr>
	</table>

  <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
  </script>
    
</body>
</html>
