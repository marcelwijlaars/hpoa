<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css" />
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css" />
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css" />
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tableManager.js"></script>
<script type="text/javascript" src="../js/users.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/batchManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var encNum;
var groupName;
var action;
var hpem=null;
var formMgr=null;
var ourInputValidator=null;
function loadContent(){
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
groupName=unescape(getSearchValue(location.search,'groupName'));
action=getSearchValue(location.search,'action');
try{
top.mainPage.setMainTitle(top.getString('directoryGroups'));
top.mainPage.getNavigationFrame().highlightGroup(groupName,encNum);
}
catch(e){}
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
if(action=='add'){
var xml=importModule('xml');
var groupInfoDoc=xml.parseXML('<hpoa:bayPermissions xmlns:hpoa="hpoa.xsd" />');
var processor=new XsltProcessor('../Templates/editGroup.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('action',action);
processor.addParameter('groupInfoDoc',groupInfoDoc);
processor.addParameter('encNum',encNum);
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('userOaAccess',hpem.getUserOaPermission());
processor.addParameter('enclosureType',hpem.getEnclosureType());
processor.addParameter('lcdInfoDoc',hpem.getLcdInfo());
processor.addParameter('isTower',hpem.getIsTower()+"");
processor.addParameter('numDeviceBays',hpem.getNumBlades());
processor.addParameter('numIoBays',hpem.getNumTrays());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
var waitPhrase=top.getString('addingGroup');
var waitDescription=top.getString('addingGroupSettings');
formMgr=new FormManager(groupAddedResponse);
formMgr.createWaitContainer(waitPhrase,waitDescription);
ourInputValidator=new InputValidator(null,'errorDisplay',true);
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_GROUP_ADD");
reconcilePage();
loadCurrentSettings(encNum);
}
else if(action=='edit'){
if(groupName!=''){
groupName=unescape(groupName);
var processor=new XsltProcessor('../Templates/editGroup.xsl');
processor.addParameter('encNum',encNum);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('action',action);
processor.addParameter('groupInfoDoc',hpem.getLdapGroupInfo(groupName));
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('userOaAccess',hpem.getUserOaPermission());
processor.addParameter('enclosureType',hpem.getEnclosureType());
processor.addParameter('lcdInfoDoc',hpem.getLcdInfo());
processor.addParameter('isTower',hpem.getIsTower()+"");
processor.addParameter('numDeviceBays',hpem.getNumBlades());
processor.addParameter('numIoBays',hpem.getNumTrays());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
hpem.registerEventHandler(ldapGroupDeleted,['EVENT_LDAPGROUP_DELETED']);
var waitPhrase=top.getString('updatingGroup');
var waitDescription=top.getString('updatingGroupSettings');
formMgr=new FormManager(groupUpdated);
formMgr.createWaitContainer(waitPhrase,waitDescription);
ourInputValidator=new InputValidator(null,'errorDisplay',true);
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_GROUP_EDIT");
reconcilePage();
loadCurrentSettings(encNum);
}
else{
displayContentFailed('bodyContent',[top.getString('groupNameNotFound')]);
}
}
}
else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('bodyContent',[e.message]);
}
}
function ldapGroupDeleted(result){
var removedLdapGroupname=getElementValueXpath(result,'//hpoa:message');
if(removedLdapGroupname==groupName){
document.getElementById('bodyContent').innerHTML=top.getString('theLdapGroupWasRemoved');
}
}
function unregisterEventHandlers(){
hpem.removeRegisteredHandler(ldapGroupDeleted);
}
function addGroup(){
if(ourInputValidator.allInputsValidate()){
gInfo=getGroupInfo(encNum);
var batchMgr=new BatchManager(function(success){
if(success){
groupUpdated(true);
}else{
if(trans1.getTotalErrors()>0){
}else if(trans2.getTotalErrors()>0){
var groupButtonWrapper=document.getElementById('groupButtonWrapper');
var actionButtonWrapper=document.getElementById('actionButtonWrapper');
var editButton=getHPButton('settingsButton',top.getString('apply'),function(){applyGroupSettings(groupUpdated);},false);
groupButtonWrapper.replaceChild(editButton,actionButtonWrapper);
var actionLabel=document.getElementById('actionLabel');
actionLabel.innerHTML='<b>'+top.getString('edtLdapgrp')+'</b><br />';
var groupName=document.getElementById('groupName');
groupName.className='stdInputDisabled';
groupName.disabled=true;
var waitPhrase=top.getString('updatingGroup');
var waitDescription=top.getString('updatingGroupSettings');
formMgr=new FormManager(groupUpdated);
formMgr.createWaitContainer(waitPhrase,waitDescription);
ourInputValidator=new InputValidator(null,'errorDisplay',true);
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_GROUP_EDIT");
gInfo=null;
reconcilePage();
}
}
},false,'errorDisplay');
batchMgr.createWaitContainer(top.getString('addingDirectoryGrp'));
var batch=batchMgr.addBatch('Add Directory Group');
var trans1=batch.addTransaction('Adding Directory Group',new FormManager(),true);
trans1.formMgr.queueCall(hpem.addLdapGroup,[gInfo['groupName']],['lblGroupName']);
var trans2=batch.addTransaction('Updating Group Settings',new FormManager());
trans2.formMgr.queueCall(hpem.setLdapGroupDescription,[gInfo['groupName'],gInfo['description']],['groupDescription']);
if(gInfo['groupBayAcl']!=null){
trans2.formMgr.queueCall(hpem.setLdapGroupBayAcl,[gInfo['groupName'],gInfo['groupBayAcl']]);
}
if(gInfo['permissionsToAdd']!=null){
trans2.formMgr.queueCall(hpem.addLdapGroupBayAccess,[gInfo['groupName'],gInfo['permissionsToAdd']]);
}
if(gInfo['permissionsToRemove']!=null){
trans2.formMgr.queueCall(hpem.removeLdapGroupBayAccess,[gInfo['groupName'],gInfo['permissionsToRemove']],[],['316']);
}
batchMgr.runBatches();
}else{
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
}
}
function groupAddedResponse(success){
if(success==true){
applyGroupSettings(groupAdded);
}else{
alert(top.getString('errorAddingGroup'));
formMgr.reset();
}
}
function applyGroupSettings(callback){
if(typeof(callback)!='undefined'&&callback){
formMgr=new FormManager(callback);
}
if(ourInputValidator.allInputsValidate()){
if(gInfo==null){
gInfo=getGroupInfo(encNum);
}
formMgr.startBatch();
formMgr.queueCall(hpem.setLdapGroupDescription,[gInfo['groupName'],gInfo['description']],['groupDescription']);
if(gInfo['groupBayAcl']!=null){
formMgr.queueCall(hpem.setLdapGroupBayAcl,[gInfo['groupName'],gInfo['groupBayAcl']]);
}
if(gInfo['permissionsToAdd']!=null){
formMgr.queueCall(hpem.addLdapGroupBayAccess,[gInfo['groupName'],gInfo['permissionsToAdd']]);
}
if(gInfo['permissionsToRemove']!=null){
formMgr.queueCall(hpem.removeLdapGroupBayAccess,[gInfo['groupName'],gInfo['permissionsToRemove']],[],['316']);
}
formMgr.endBatch();
}
else{
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
}
gInfo=null;
}
function groupUpdated(success){
if(!success){
gInfo=null;
}
else{
document.getElementById('bodyContent').innerHTML='';
setTimeout('loadGroupOverview()',500);
}
}
function groupAdded(success){
if(success){
document.getElementById('bodyContent').innerHTML='';
setTimeout('loadGroupOverview()',500);
}
else{
}
}
function loadGroupOverview(){
location='directoryGroups.html?encNum='+encNum;
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="unregisterEventHandlers();">
	<div id="bodyContent"></div>
	<div id="waitContainer" class="waitContainer"></div>
</body>
</html>

