<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>HP BladeSystem Onboard Administrator</title>
	<link rel="stylesheet" type="text/css" href="../css/default.css" />
	<link rel="stylesheet" type="text/css" href="../css/blue_theme.css" />
	<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css" />

	<script type="text/javascript" src="../js/EnvironConstants.js"></script>
	<script type="text/javascript" src="../js/buttonManager.js"></script>
	<script type="text/javascript" src="../js/tabManager.js"></script>
	<script type="text/javascript" src="../js/global.js"></script>
	<script type="text/javascript" src="../js/inputValidator.js"></script>
	<script type="text/javascript" src="../js/domBuilder.js"></script>
	<script type="text/javascript" src="../js/formManager.js"></script>
	<script type="text/javascript" src="../js/displayManager.js"></script>
	<script type="text/javascript" src="../js/browser.js"></script>
	<script type="text/javascript" src="../js/init.js"></script>
	<script type="text/javascript" src="../js/xml.js"></script>
	<script type="text/javascript" src="../js/xslt.js"></script>
	<script type="text/javascript">
var emNum;
var encNum;
var otherNum;
var hpem=null;
var oaStatus=null;
var oaInfo=null;
var isStandby=false;
var hasStandby=false;
var settingStandby=false;
var oaName;
var fwVersion;
var standbyOaName;
function loadContent(){
try{
emNum=parseInt(getSearchValue(location.search,'emNum'));
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(emNum)&&!isNaN(encNum)&&
(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
if((emNum<1)||(emNum>2)){emNum=1;}
otherNum=1;
if(emNum==1)otherNum=2;
oaStatus=hpem.getOaStatus(emNum);
oaName=getElementValueXpath(oaStatus,'//hpoa:oaName');
oaInfo=hpem.getOaInfo(emNum);
fwVersion=getElementValueXpath(oaInfo,'//hpoa:fwVersion');
if(getElementValueXpath(oaStatus,'//hpoa:oaRole')==STANDBY()){
isStandby=true;
hasStandby=true;
standbyOaName=getElementValueXpath(hpem.getOaStatus(otherNum),'//hpoa:oaName');
top.mainPage.setMainTitle(top.getString('certificateAdminStandbyTitle'));
}else{
var otherOaRole=getElementValueXpath(hpem.getOaStatus(otherNum),'//hpoa:oaRole');
if(otherOaRole!=null&&otherOaRole.length>0&&otherOaRole!="OA_ABSENT"){
hasStandby=true;
standbyOaName=getElementValueXpath(hpem.getOaStatus(otherNum),'//hpoa:oaName');
}
top.mainPage.setMainTitle(top.getString('certificateAdminTitle'));
}
}
else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('bodyContent',[e.message]);
}
adjustTabDisplay();
selectTab('certInfo');
reconcilePage();
}
function selectTab(tabId){
if(!isNaN(emNum)&&!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
ourTabManager.toggleTabs(tabId);
setTabContent(tabId);
}
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function setTabContent(tabId){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('content_location');
var contextId=contentTab.getAttribute('context_id');
if(isStandby==true){
contextId+="_STANDBY";
}
top.mainPage.getHelpLauncher().setCurrentTopic(contextId);
if(contentLocation){
loadCertificateInfo(contentLocation,tabId);
}
}
function loadCertificateInfo(contentLocation,tabId){
var formMgr=new FormManager(function(success){
if(success||tabId=='certRequest'){
var processor=new XsltProcessor(contentLocation);
if(tabId=='certInfo'||tabId=='certRequest'){
var res=formMgr.getDataByCallIndex(0);
try{if(res.xml==null||res.xml==''){
var xml=importModule('xml');
res=xml.parseXML("<document />");
}
}catch(e){
var xml=importModule('xml');
res=xml.parseXML("<document />");
};
processor.addParameter('certificateInfoDoc',res);
processor.addParameter('oaName',oaName);
processor.addParameter('emSelectId',emNum);
processor.addParameter('enclosureNumber',encNum);
processor.addParameter('fwVersion',fwVersion);
}
if(tabId=='certRequest'){
processor.addParameter('hasStandby',hasStandby);
processor.addParameter('isStandby',isStandby);
if(hasStandby){
processor.addParameter('standbyOaName',standbyOaName);
}
}
processor.addParameter('stringsDoc',top.getStringsDoc());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
if(tabId=='certInfo'&&(Number(fwVersion)<Number(1.20))){
displayContentFailed('fwVersionContent',[top.getString('thisOAhasOlderFirmwareVersion'),top.getString('goFirmwarePageandUploadLatestVersion')]);
}
}
else{
var errorsArray=formMgr.getErrorsArray();
errorsArray.push(top.getString("oaResetInfo"));
displayContentFailed('bodyContent',errorsArray);
}
reconcilePage();
if(tabId=='certRequest'){
try{
toggleFormEnabled('standbyContainer',false);
toggleFormEnabled('csrContainer',false);
}catch(e){}
}
},true,'','bodyContent');
with(formMgr){
if(tabId=='certInfo'||tabId=='certRequest'){
startBatch(true);
if(fwVersion<"1.20"){
queueCall(hpem.getSslCertificateInfo);
}else{
queueCall(hpem.getSslCertificateInfoEx,[emNum]);
}
endBatch();
}
}
if(tabId=='certUpload'){
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
reconcilePage();
}
}
function certificateRequestSubmit(){
var csr=document.getElementById('csrReq').checked;
settingStandby=false;
try{settingStandby=document.getElementById('standby').checked;}catch(e){}
var validationFailed=false;
var ourInputValidator=new InputValidator('validate-required','requiredErrorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
validationFailed=true;
}else{
ourInputValidator.clearMessages();
}
if(settingStandby||hasStandby){
ourInputValidator=new InputValidator('validate-standby','standbyErrorDisplay',true);
if(!settingStandby){
ourInputValidator.clearMessages();
}else{
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
validationFailed=true;
}else{
ourInputValidator.clearMessages();
}
}
}
ourInputValidator=new InputValidator('validate-optional','optionalErrorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
validationFailed=true;
}else{
ourInputValidator.clearMessages();
}
ourInputValidator=new InputValidator('validate-csr','csrErrorDisplay',true);
if(!csr){
ourInputValidator.clearMessages();
}else{
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
validationFailed=true;
}else{
ourInputValidator.clearMessages();
}
}
if(validationFailed==true){
return;
}
var country=document.getElementById('country').value;
var stateOrProvince=document.getElementById('stateOrProvince').value;
var cityOrLocality=document.getElementById('cityOrLocality').value;
var organizationName=document.getElementById('organizationName').value;
var subjectCommonName=document.getElementById('subjectCommonName').value;
var subjectCommonNameStandby=null;
if(settingStandby){
subjectCommonNameStandby=document.getElementById('subjectCommonNameStandby').value;
}
var subjectAltName=document.getElementById('subjectAlternativeName').value;
var contactPerson=document.getElementById('contactPerson').value;
var emailAddress=document.getElementById('emailAddress').value;
var organizationalUnit=document.getElementById('organizationalUnit').value;
var surname=document.getElementById('surname').value;
var givenName=document.getElementById('givenName').value;
var initials=document.getElementById('initials').value;
var dnQualifier=document.getElementById('dnQualifier').value;
if(csr){
var password=document.getElementById('password').value;
var passwordConfirm=document.getElementById('passwordConfirm').value;
var unstructuredName=document.getElementById('unstructuredName').value;
}
var domBuilder=new DomBuilder();
domBuilder.addDocument("hpoa:certificateDataEx",['xmlns:'+OA_NAMESPACE(),OA_NAMESPACE_URI()]);
domBuilder.appendChild("hpoa:subjectCommonName",'',subjectCommonName);
domBuilder.appendChild("hpoa:organizationName",'',organizationName);
domBuilder.appendChild("hpoa:cityOrLocality",'',cityOrLocality);
domBuilder.appendChild("hpoa:stateOrProvince",'',stateOrProvince);
domBuilder.appendChild("hpoa:country",'',country);
if(organizationalUnit!=''){
domBuilder.appendChild("hpoa:organizationalUnit",'',organizationalUnit);
}
if(contactPerson!=''){
domBuilder.appendChild("hpoa:contactPerson",'',contactPerson);
}
if(emailAddress!=''){
domBuilder.appendChild("hpoa:emailAddress",'',emailAddress);
}
if(surname!=''){
domBuilder.appendChild("hpoa:surname",'',surname);
}
if(givenName!=''){
domBuilder.appendChild("hpoa:givenName",'',givenName);
}
if(initials!=''){
domBuilder.appendChild("hpoa:initials",'',initials);
}
if(dnQualifier!=''){
domBuilder.appendChild("hpoa:dnQualifier",'',dnQualifier);
}
if(password!=''){
domBuilder.appendChild("hpoa:challengePassword",'',password);
}
if(unstructuredName!=''){
domBuilder.appendChild("hpoa:unstructuredName",'',unstructuredName);
}
if(subjectAltName!=''){
domBuilder.appendChild("hpoa:subjectAlternativeName",'',subjectAltName);
}
if(csr){
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor('../Templates/certificateRequestResult.xsl');
var certRequest=formMgr.getDataByCallIndex(0);
processor.addParameter('certificateRequest',certRequest);
if(settingStandby){
certRequest=formMgr.getDataByCallIndex(1);
processor.addParameter('certificateRequestStandby',certRequest);
}
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('isStandby',isStandby)
document.getElementById('bodyContent').innerHTML=processor.getOutput();
}
else{
displayContentFailed('bodyContent',formMgr.getErrorsArray());
}
reconcilePage();
},true,'','bodyContent');
with(formMgr){
startBatch(true);
queueCall(hpem.generateCsrEx,[emNum,domBuilder.getDocument().documentElement.cloneNode(true)]);
if(settingStandby){
domBuilder.removeChild(null,"//hpoa:certificateDataEx","//hpoa:subjectCommonName");
domBuilder.appendChild("hpoa:subjectCommonName",'',subjectCommonNameStandby);
queueCall(hpem.generateCsrEx,[otherNum,domBuilder.getDocument().documentElement.cloneNode(true)]);
}
endBatch();
}
}else{
var confirmCreate=top.getString('generatingNewSelfCertReplaceCurrentSSLCert')+'\n';
if(!isStandby||(settingStandby&&isStandby)){
if(hpem.getIsLocal()){
confirmCreate+=top.getString('allOpenSessionResetAndSignedOut')+'\n';
}else{
confirmCreate+=top.getString('oaWillBeReset')+' ';
confirmCreate+=top.getString('thisEncRemovedFromTopologyUntilReset')+'\n';
}
}
else{
confirmCreate+=top.getString('standbyOAResetandUnresponsive')+'\n';
}
confirmCreate+=top.getString('areYouSure');
if(confirm(confirmCreate)){
var formMgr=new FormManager(function(success){
if(success){
if(!hpem.getIsLocal()&&(!isStandby||(settingStandby&&isStandby))){
top.getTopology().removeProxy(hpem.getUuid());
}
selectTab('certInfo');
}else{
displayContentFailed('bodyContent',formMgr.getErrorsArray());
}
},false);
formMgr.createWaitContainer(top.getString('creatingSelfSignedCert'));
formMgr.startBatch();
if(settingStandby&&!isStandby){
domBuilder.removeChild(null,"//hpoa:certificateDataEx","//hpoa:subjectCommonName");
domBuilder.appendChild("hpoa:subjectCommonName",'',subjectCommonNameStandby);
formMgr.queueCall(hpem.generateSelfSignedCertificateEx,[otherNum,domBuilder.getDocument().documentElement.cloneNode(true)]);
}
domBuilder.removeChild(null,"//hpoa:certificateDataEx","//hpoa:subjectCommonName");
domBuilder.appendChild("hpoa:subjectCommonName",'',subjectCommonName);
formMgr.queueCall(hpem.generateSelfSignedCertificateEx,[emNum,domBuilder.getDocument().documentElement.cloneNode(true)]);
if(settingStandby&&isStandby){
domBuilder.removeChild(null,"//hpoa:certificateDataEx","//hpoa:subjectCommonName");
domBuilder.appendChild("hpoa:subjectCommonName",'',subjectCommonNameStandby);
formMgr.queueCall(hpem.generateSelfSignedCertificateEx,[otherNum,domBuilder.getDocument().documentElement.cloneNode(true)]);
}
formMgr.endBatch();
}
}
}
function uploadCertificate(){
var confirmCreate=top.getString('uploadingNewCertReplaceCurrentSSLCert')+'\n';
if(!isStandby){
if(hpem.getIsLocal()){
confirmCreate+=top.getString('allOpenSessionResetAndSignedOut')+'\n';
}else{
confirmCreate+=top.getString('oaWillBeReset')+' ';
confirmCreate+=top.getString('thisEncRemovedFromTopologyUntilReset')+'\n';
}
}
else{
confirmCreate+=top.getString('standbyOAResetandUnresponsive')+'\n';
}
confirmCreate+=top.getString('areYouSure');
var certContent=document.getElementById('certificateContents').value;
if(certContent!=''){
if(confirm(confirmCreate)){
var formMgr=new FormManager(function(success){
if(success){
if(!hpem.getIsLocal()&&(!isStandby)){
top.getTopology().removeProxy(hpem.getUuid());
}
selectTab('certInfo');
}
},false);
formMgr.createWaitContainer(top.getString('sendingCert'));
formMgr.startBatch();
formMgr.queueCall(hpem.setCertificateEx,[emNum,certContent]);
formMgr.endBatch();
}
}
else{
alert(top.getString('alrtProvideValidCertBeforeSubmit'));
}
}
function downloadCertificate(){
var confirmCreate=top.getString('uploadingNewCertReplaceCurrentSSLCert')+'\n';
if(!isStandby){
confirmCreate+=top.getString('allOpenSessionResetAndMaySignedOut');
}
confirmCreate+=top.getString('areYouSure');
var certUrl=document.getElementById('certUrl').value;
if(certUrl!=''){
if(confirm(confirmCreate)){
var formMgr=new FormManager(function(success){
if(success){
selectTab('certInfo');
}
},false);
formMgr.createWaitContainer(top.getString('downloadingCertificate'));
formMgr.startBatch();
formMgr.queueCall(hpem.downloadCertificateEx,[emNum,certUrl]);
formMgr.endBatch();
}
}
else{
alert(top.getString('enterValidCertURL'));
}
}
function createSelfSignedCert(){
var confirmCreate=top.getString('generatingNewSelfCertReplaceCurrentSSLCert')+'\n';
confirmCreate+=top.getString('allOpenSessionResetAndSignedOut')+'\n';
confirmCreate+=top.getString('areYouSure');
if(confirm(confirmCreate)){
var formMgr=new FormManager(function(){
top.logout();
},false);
formMgr.createWaitContainer(top.getString('creatingSelfSignedCert'));
formMgr.startBatch();
formMgr.queueCall(hpem.createSelfSignedCertificate);
formMgr.endBatch();
}
}
function restartOa(){
var emNum=getElementValueXpath(hpem.getOaStatusDOM(),'//hpoa:oaStatus[hpoa:oaRole="ACTIVE"]/hpoa:bayNumber');
hpem.resetOa(emNum,5,function(result){});
}
function adjustTabDisplay(){
if(fwVersion>="1.20"&&hpem.getUserAccessLevel()=='ADMINISTRATOR'&&hpem.getUserOaPermission()==true){
document.getElementById('certRequest').style.display='block';
document.getElementById('certUpload').style.display='block';
}else{
document.getElementById('certRequest').style.display='none';
document.getElementById('certUpload').style.display='none';
}
};
function editOaName(){
top.mainPage.setContentLocation('../html/oaNetSettings.html?emNum='+emNum+'&encNum='+encNum);
top.mainPage.getHiddenFrame().selectedDeviceChanged();
var devid='enc'+encNum+'NetSettingsSelect';
if(isStandby)devid='enc'+encNum+'StandbyNetSettingsSelect';
top.mainPage.getNavigationFrame().highlightDevice(devid);
if(isStandby){
top.mainPage.setMainTitle(top.getString('standbyEM'));
}else{
top.mainPage.setMainTitle(top.getString('activeEM'));
}
}
	</script>

</head>
<body class="body-padded" onload="loadContent();">
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
		<tr>
			<td valign="bottom">
				<div class="tabSet" id="tabSet">
					<div class="tabOff" tabid="certInfo" context_id="FORM_ENC_CERTIFICATE_INFO" id="certInfo"
						content_location="../Templates/certificateInformation.xsl">
						<script type="text/javascript">document.write(top.getString('information'));</script></div>
					<div class="tabOff" tabid="certRequest" context_id="FORM_ENC_CERTIFICATE_REQUEST"
						id="certRequest" content_location="../Templates/certificateRequest.xsl">
						<script type="text/javascript">document.write(top.getString('certificateRequest'));</script></div>
					<div class="tabOff" tabid="certUpload" context_id="FORM_ENC_CERTIFICATE_UPLOAD" id="certUpload"
						content_location="../Templates/certificateUpload.xsl">
						<script type="text/javascript">document.write(top.getString('certificateUpload'));</script></div>
					<div class="tabBottomLine">
					</div>
				</div>
			</td>
		</tr>
		<tr>
			<td style="padding-top: 10px;">
				<div id="bodyContent">
				</div>
				<div id="waitContainer">
				</div>
			</td>
		</tr>
	</table>

  <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
  </script>

</body>
</html>
