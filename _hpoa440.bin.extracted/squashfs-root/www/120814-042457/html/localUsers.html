<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tableManager.js"></script>
<script type="text/javascript" src="../js/users.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
var formMgr=null;
function loadContent(){
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
try{
top.mainPage.getNavigationFrame().highlightDevice('enc'+encNum+'user0Select');
}
catch(e){}
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
var processor=new XsltProcessor('../Forms/UserOverviewPage.xsl');
processor.addParameter('usersDoc',hpem.getUsersDOM());
processor.addParameter('stringsDoc',top.getStringsDoc());
document.getElementById('bodyContent').innerHTML=processor.getOutput();
var waitPhrase=top.getString('deletingUsers');
formMgr=new FormManager();
formMgr.createWaitContainer(waitPhrase);
initUserOverview(editSecObject,newSecObject,deleteSecObject);
try{
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_USER_OVERVIEW");
}catch(e){}
hpem.registerEventHandler(usersChangedHandler,['EVENT_USER_ADDED','EVENT_USER_DELETED','EVENT_USER_INFO_CHANGED','EVENT_ADMIN_RIGHTS_CHANGED','EVENT_USER_PERMISSION']);
reconcilePage();
}
else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('bodyContent',[e.message]);
}
}
function usersChangedHandler(result){
var processor=new XsltProcessor('../Templates/userOverviewTableExternal.xsl');
processor.addParameter('usersDoc',hpem.getUsersDOM(true));
processor.addParameter('stringsDoc',top.getStringsDoc());
document.getElementById('userOverviewTableContainer').innerHTML=processor.getOutput();
initUserOverview(editSecObject,newSecObject,deleteSecObject);
}
function editSecObject(){
var secObjects=getSelectedSecObjects();
if(secObjects.length==1){
location='editUser.html?encNum='+encNum+'&username='+secObjects[0]+'&action=edit';
}
}
function newSecObject(){
location='addUser.html?encNum='+encNum;
}
function deleteSecObject(){
var triedAdministrator=false;
var triedSelf=false;
var secObjects=getSelectedSecObjects();
for(var i=secObjects.length-1;i>=0;i--){
if(secObjects[i]==ADMINISTRATOR()){
secObjects.splice(i,1);
triedAdministrator=true;
}
else if(secObjects[i].toLowerCase()==hpem.getCurrentServiceUser().toLowerCase()){
secObjects.splice(i,1);
triedSelf=true;
}
}
if(secObjects.length>0){
var confirmString=top.getString('reallyDeleteUsers');
var note='\n'+top.getString('note:')+' ';
if(triedAdministrator&&!triedSelf){
confirmString+=note+top.getString('adminAccountCannotBeDeleted');
}
else if(triedSelf&&!triedAdministrator){
confirmString+=note+top.getString('currentAccountCannotBeDeleted');
}
else{
confirmString+=note+top.getString('neitherAccountCanBeDeleted');
}
if(confirm(confirmString)){
formMgr.startBatch();
for(var i=0;i<secObjects.length;i++){
formMgr.queueCall(hpem.removeUser,[secObjects[i]]);
}
formMgr.endBatch();
}
}
else{
containerCheckboxToggle('secObjectContainer',false);
userSelected();
if(triedSelf){
alert(top.getString('currentAccountCannotBeDeleted'));
}
}
}
function deRegisterEventHandler(){
hpem.removeRegisteredHandler(usersChangedHandler);
}
	</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="deRegisterEventHandler();">
	<div id="bodyContent"></div>
	<div id="waitContainer" class="waitContainer"></div>
</body>
</html>
