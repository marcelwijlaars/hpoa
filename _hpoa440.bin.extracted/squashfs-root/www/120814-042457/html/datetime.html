<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript" src="../js/ipv4.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
var ipMgr=new IPv4Manager();
function loadContent(){
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor('../Forms/DateTimePage.xsl');
var timeZonesDoc=formMgr.getDataByCallIndex(2);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('dateTimeDoc',hpem.getEnclosureTime());
processor.addParameter('networkInfoDoc',hpem.getEnclosureNetworkInfo());
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.setSourceDocument(timeZonesDoc);
document.getElementById('bodyContent').innerHTML=processor.getOutput();
if(convertAccessLevel(hpem.getUserAccessLevel())>1){
reconcilePage();
}else{
toggleFormEnabled("bodyContent",false);
}
});
formMgr.startBatch(true,true);
formMgr.queueCall(hpem.getEnclosureTime);
formMgr.queueCall(hpem.getEnclosureNetworkInfo);
formMgr.queueCall(hpem.getTimeZones);
formMgr.endBatch();
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_OA_DATE_TIME");
}else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}
catch(e){
displayContentFailed('bodyContent',[e.message]);
}
}
function setDateTime(){
var displayMgr=new DisplayManager(null,null,'dateErrorDisplay');
displayMgr.clearErrorContainers();
var ourInputValidator=new InputValidator('validate-datetime','dateErrorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
return;
}
var date=document.getElementById('date').value;
var time=document.getElementById('time').value;
var timeZone='';
if(document.getElementById('timeZone')!=null){
timeZone=document.getElementById('timeZone').value;
}
else{
var tz_list=document.getElementById('tz_list');
if(tz_list!=null){
timeZone=tz_list.options[tz_list.selectedIndex].value;
}
}
if(date.match(REGEX_DATE())==null){
displayMgr.showErrors(top.getString('invalidDateMessage'));
return;
}
if(time.match(REGEX_TIME())==null){
displayMgr.showErrors(top.getString('invalidTimeMessage'));
return;
}
var dateTime=date+'T'+time+':00';
var waitPhrase=top.getString('completingDateTime');
var waitDescription=top.getString('completingDateTimeDes');
var formMgr=new FormManager(null,false,'dateErrorDisplay');
formMgr.createWaitContainer(waitPhrase,waitDescription);
formMgr.startBatch();
formMgr.queueCall(hpem.setNetworkProtocol,[NET_PROTO_NTP(),false],[],['83','84']);
formMgr.queueCall(hpem.setEnclosureTimeZone,[timeZone],['timeZoneLabel']);
formMgr.queueCall(hpem.setEnclosureTime,[dateTime],['dateLabel','timeLabel']);
formMgr.endBatch();
}
function setupNTP(){
var displayMgr=new DisplayManager(null,null,'ntpErrorDisplay');
displayMgr.clearErrorContainers();
var ourInputValidator=new InputValidator('validate-ntp','ntpErrorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
return;
}
var ntpEnabled=true;
var ntpServer1=document.getElementById('ntp1').value;
var ntpServer2=document.getElementById('ntp2').value;
var pollInterval=document.getElementById('pollInterval').value;
var timeZone='';
var waitPhrase=top.getString('completingDateTime');
var waitDescription=top.getString('completingDateTimeDes');
if(ntpServer1!=''&&ntpServer2!=''){
if(ntpServer1==ntpServer2){
displayMgr.showErrors(top.getString('duplicateNtpMsg'));
return;
}
}
ntpServer2=(ntpServer2=='')?'0.0.0.0':ntpServer2;
if(document.getElementById('timeZone_ntp')!=null){
timeZone=document.getElementById('timeZone_ntp').value;
}
else{
var tz_list=document.getElementById('tz_list_ntp');
if(tz_list!=null){
timeZone=tz_list.options[tz_list.selectedIndex].value;
}
}
var formMgr=new FormManager(function(success){
if(success){
var formMgrProtocol=new FormManager(null,false,'ntpErrorDisplay');
formMgrProtocol.createWaitContainer(waitPhrase,waitDescription);
formMgrProtocol.startBatch();
formMgrProtocol.queueCall(hpem.setNetworkProtocol,[NET_PROTO_NTP(),ntpEnabled],[],['83','84']);
formMgrProtocol.endBatch();
}
},false,'ntpErrorDisplay');
formMgr.createWaitContainer(waitPhrase,waitDescription);
formMgr.startBatch();
if(hpem.getActiveFirmwareVersion()>=2.10){
formMgr.queueCall(hpem.configureNtp,[ntpServer1,ntpServer2,pollInterval],['','','']);
}else{
formMgr.queueCall(hpem.setNtpPrimary,[ntpServer1],['ntpLabel1']);
formMgr.queueCall(hpem.setNtpSecondary,[ntpServer2],['ntpLabel2']);
}
formMgr.queueCall(hpem.setEnclosureTimeZone,[timeZone],['timeZoneLabel']);
formMgr.endBatch();
}
function setupDateTime(){
var useManual=document.getElementById('manualOrNtp_manual').checked;
if(useManual){
setDateTime();
}else{
setupNTP();
}
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();">
    <div id="bodyContent"></div>
    <div id="waitContainer" class="waitContainer"></div>
</body>
</html>
