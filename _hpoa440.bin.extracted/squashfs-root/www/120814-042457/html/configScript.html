<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css"/>
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css"/>
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css"/>
<!--[if gte IE 11]>
  <script type="text/javascript">
var browserDOM7011=true;
  </script>  
<![endif]-->
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/postBackManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>

<script type="text/javascript">
var encNum;
var bayNum;
var hpem=null;
function loadContent(){
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
bayNum=parseInt(getSearchValue(location.search,'emNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
top.mainPage.setMainTitle(top.getString('enclosureSettings')+' - '+hpem.getEnclosureName());
top.mainPage.getHelpLauncher().setCurrentTopic("FORM_ENC_CONFIG_SCRIPTS");
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor('../Forms/configScripts.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('oaSessionKey',(hpem.getActiveFirmwareVersion()<2.00?hpem.getSessionKey():""));
processor.addParameter('oaUrl',removeTrailingSlash(getServiceUrl(hpem.getIsLocal()?'':hpem.getProxyUrl(),true)));
document.getElementById('bodyContent').innerHTML=ipv6UrlFix(processor.getOutput());
transformUsbForm();
reconcilePage();
},false);
formMgr.startBatch(true);
formMgr.queueCall(hpem.getOaMediaDeviceArray,[bayNum]);
formMgr.queueCall(hpem.getUsbMediaConfigScripts);
formMgr.endBatch();
hpem.registerEventHandler(transformUsbForm,['EVENT_USB_OA_CONFIG_SCRIPTS','EVENT_MEDIA_INSERTED','EVENT_MEDIA_REMOVED']);
}else{
displayContentFailed('bodyContent',[top.getString('noOnboardAdmin')]);
}
}catch(e){
displayContentFailed('bodyContent',[e.message]);
}
}
function transformUsbForm(){
var processor=new XsltProcessor('../Forms/UsbConfigForm.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('usbConfigScriptDoc',hpem.getUsbMediaConfigScripts());
processor.addParameter('oaMediaDeviceDoc',hpem.getOaMediaDeviceDOM());
processor.addParameter('usbConfigSupported',(hpem.getActiveFirmwareVersion()>=2.30));
document.getElementById('usbConfigContainer').innerHTML=processor.getOutput();
setTimeout('reconcilePage();',200);
}
function submitConfigScript(){
var displayMgr=new DisplayManager('bodyContent','waitContainer','uploadErrorDisplay');
displayMgr.clearErrorContainers();
ourInputValidator=new InputValidator('validate-upload-script','uploadErrorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
return;
}
hpem.setProperty("ConfigScriptInProgress",true);
try{
document.getElementById('scriptUploadForm').submit();
displayMgr.createWaitContainer(top.getString('completingScriptUploadExec'));
displayMgr.showWaitScreen();
}catch(e){
var errMsg=e.message;
if(e.number==-2147024891){
errMsg=top.getString('invalidFilename');
}
displayMgr.showErrors(errMsg);
hpem.setProperty("ConfigScriptInProgress",false);
}
return false;
}
function postFrameLoaded(targetDocument){
var postBackMgr=new PostBackManager(targetDocument,'scriptUploadForm','scriptLog');
if(postBackMgr.getIsPostBack()){
hpem.setProperty("ConfigScriptInProgress",false);
var displayMgr=new DisplayManager('bodyContent','waitContainer','uploadErrorDisplay');
displayMgr.showMainScreen();
if(postBackMgr.getSuccess()){
displayMgr.openLogWindow(postBackMgr.getResponseValue('scriptLog'),top.getString('configurationResults'),false,true);
if(browserDOM7011==true){
window.setTimeout("loadContent()",500);
}
}else{
displayMgr.showErrors(postBackMgr.getErrorString());
}
}
}
function downloadConfigScript(){
var displayMgr=new DisplayManager('bodyContent','waitContainer','downloadErrorDisplay');
displayMgr.clearErrorContainers();
ourInputValidator=new InputValidator('validate-download-script','downloadErrorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
return;
}
var url=document.getElementById('configUrl').value;
if(hpem){
hpem.setProperty("ConfigScriptInProgress",true);
formMgr=new FormManager(function(success){
hpem.setProperty("ConfigScriptInProgress",false);
if(success){
var resultLog=formMgr.getDataByCallIndex(0,'//hpoa:scriptLog');
formMgr.displayManager.openLogWindow(resultLog,top.getString('configurationResults'),false);
}
},false,'downloadErrorDisplay','bodyContent','waitContainer');
formMgr.createWaitContainer(top.getString('completingScriptDownloadExec'));
formMgr.makeCall(hpem.downloadConfigScript,[url]);
}else{
displayContentFailed('downloadErrorDisplay',[top.getString('noOnboardAdmin')]);
}
return false;
}
function executeScriptFromUsb(){
var displayMgr=new DisplayManager('bodyContent','waitContainer','downloadErrorDisplay');
displayMgr.clearErrorContainers();
var usbFileList=document.getElementById('usbFileList');
var url=usbFileList.options[usbFileList.selectedIndex].value;
if(hpem){
hpem.setProperty("ConfigScriptInProgress",true);
formMgr=new FormManager(function(success){
hpem.setProperty("ConfigScriptInProgress",false);
if(success){
var resultLog=formMgr.getDataByCallIndex(0,'//hpoa:scriptLog');
formMgr.displayManager.openLogWindow(resultLog,top.getString('configurationResults'),false);
}
},false,'downloadErrorDisplay','bodyContent','waitContainer');
formMgr.createWaitContainer(top.getString('completingScriptDownloadExec'));
formMgr.makeCall(hpem.downloadConfigScript,[url]);
}else{
displayContentFailed('downloadErrorDisplay',[top.getString('noOnboardAdmin')]);
}
return false;
}
function saveConfigScriptUsb(){
ourInputValidator=new InputValidator('validate-usb-script','saveConfigErrorDisplay',true);
if(!ourInputValidator.allInputsValidate()){
ourInputValidator.updateMessages(true);
ourInputValidator.autoFocus();
return;
}
var fileName='';
var fileNameBox=document.getElementById('usbFileName');
var formMgr;
if(fileNameBox==null){
return;
}
fileName=fileNameBox.value;
formMgr=new FormManager(function(success){
if(success){
alert(top.getString('genericSuccessMessage'));
}
},false,'saveConfigErrorDisplay');
formMgr.createWaitContainer(top.getString('savingConfig'));
formMgr.makeCall(hpem.generateOaConfigUsb,[fileName]);
}
function load_config_script(){
openCgiWindow("cgi-bin/getConfigScript",hpem);
}
function load_show_all(){
openCgiWindow("cgi-bin/showAll",hpem);
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();">
    <div id="bodyContent"></div>
    <div id="waitContainer" class="waitContainer"></div>    
</body>
</html>
