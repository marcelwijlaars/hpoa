<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<link rel="stylesheet" type="text/css" href="../Help/stylesheets/help.css" />
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/inputValidator.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/tableManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/batchManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript" src="../js/snmp.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
function loadContent(){
try{
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
var tabName='snmpSettings';
if(hpem.hasSNMPv3()){
var tabParam=getSearchValue(location.search,'tab');
if(tabParam!=null&&(tabParam=='snmpSettings'||tabParam=='snmpUsers')){
tabName=tabParam;
}
}
ourTabManager.toggleTabs(tabName);
setTabContent(tabName);
hpem.registerEventHandler(handleSnmpEvent,['EVENT_SNMP_INFO_CHANGED']);
if(hpem.hasSNMPv3()){
hpem.registerEventHandler(handleSnmpv3Event,['EVENT_SNMPV3_INFO_CHANGED']);
}
if(hpem.hasSNMPv3()==false){
document.getElementById('tabSet').style.display="none";
}
}else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}catch(e){
displayContentFailed('tabContent',[e.message]);
}
}
function setTabContent(tabId){
var contentTab=document.getElementById(tabId);
var contentLocation=contentTab.getAttribute('contentLocation');
var contextHelpId=contentTab.getAttribute('contextId');
var formMgr=new FormManager(function(success){
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('snmpInfoDoc',formMgr.getDataByCallIndex(0));
processor.addParameter('networkInfoDoc',formMgr.getDataByCallIndex(1));
if(hpem.hasSNMPv3()){
processor.addParameter('snmpInfo3Doc',formMgr.getDataByCallName("getSnmpInfo3"));
}
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('testSupported',(hpem.getActiveFirmwareVersion()>=2.10));
processor.addParameter('serviceUsername',hpem.getCurrentServiceUser());
processor.addParameter('snmpv3Supported',(""+hpem.hasSNMPv3()));
document.getElementById('tabContent').innerHTML=processor.getOutput();
top.mainPage.getHelpLauncher().setCurrentTopic(contextHelpId);
reconcilePage();
},false,'errorDisplay','tabContent','waitContainer');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getSnmpInfo);
formMgr.queueCall(hpem.getEnclosureNetworkInfo);
if(hpem.hasSNMPv3()){
formMgr.queueCall(hpem.getSnmpInfo3);
}
formMgr.endBatch();
}
function setupSnmp(){
var snmpEnabled=document.getElementById('SNMPEnabled').checked;
var systemLocation=document.getElementById('systemLocation').value;
var systemContact=document.getElementById('systemContact').value;
var readCommunity=document.getElementById('readCommunity').value;
var writeCommunity=document.getElementById('writeCommunity').value;
var engineIdString='';
if(hpem.hasSNMPv3()){
engineIdString=getInputValue("engineIdString");
}
var batchMgr=new BatchManager(function(success){
if(success){
setTabContent(ourTabManager.getCurrentTab());
}
},false,'snmpErrorDisplay','tabContent','waitContainer');
batchMgr.createWaitContainer(top.getString('completingSnmpSettings'));
var batchSettings=batchMgr.addBatch('snmpSettings','');
var trans=batchSettings.addTransaction('Setting System Information',new FormManager());
trans.formMgr.batchEventDelay=3;
if(snmpEnabled){
trans.formMgr.queueCall(hpem.setSnmpLocation,[systemLocation],['systemLocationLabel']);
trans.formMgr.queueCall(hpem.setSnmpContact,[systemContact],['systemContactLabel']);
var fipsMode=hpem.getProperty("FipsEnabled");
if(!fipsMode){
trans.formMgr.queueCall(hpem.setSnmpReadCommunity,[readCommunity],['rcLabel']);
trans.formMgr.queueCall(hpem.setSnmpWriteCommunity,[writeCommunity],['wcLabel']);
}
if(hpem.hasSNMPv3()&&engineIdString.length>0){
trans.formMgr.queueCall(hpem.setSnmpEngineId,[engineIdString],['engineIdStringLabel']);
}
}
trans.formMgr.queueCall(hpem.setNetworkProtocol,['NET_PROTO_SNMP',snmpEnabled],[],['83','84']);
batchMgr.runBatches();
}
function testSnmp(){
var destinationList=getAlertDestinations(hpem);
var formMgr=new FormManager(function(success){
if(success){
alert(top.getString('testSNMPMessageWasSent')+'\n\n'+destinationList+'');
}
},false,'snmpErrorDisplay','tabContent','waitContainer');
formMgr.createWaitContainer(top.getString('testingSNMPSettings'));
formMgr.makeCall(hpem.testSnmp);
}
function toggleTestButtonEnabled(state){
if(state){
ourButtonManager.enableButtonById('testSnmp');
}else{
ourButtonManager.disableButtonById('testSnmp');
}
}
function handleSnmpEvent(result){
var systemName=getElementValueXpath(result,'//hpoa:sysName');
if(systemName!=''){
try{
document.getElementById('systemNameLabel').innerHTML=systemName;
}catch(e){}
}
updateSnmpTables(hpem,'snmpUserTableContainer','snmpTrapContainer');
}
function handleSnmpv3Event(result){
var engineid=getElementValueXpath(result,'//hpoa:engineid');
if(engineid!=''){
setInnerHTML("engineIdLabel",engineid);
}
var engineidstr=getElementValueXpath(result,'//hpoa:engineIdString');
if(engineidstr!=''){
setInputValue('engineIdString',engineidstr);
}
updateSnmpTables(hpem,'snmpUserTableContainer','snmpTrapContainer');
}
function deRegisterEventHandler(){
try{
hpem.removeRegisteredHandler(handleSnmpEvent);
hpem.removeRegisteredHandler(handleSnmpv3Event);
}catch(e){}
}
function addSnmpTrapPage(){
location='../html/addSnmpTrap.html?encNum='+encNum;
}
function addSnmpUserPage(){
location='../html/addSnmpUser.html?encNum='+encNum;
}
</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="deRegisterEventHandler();">
     
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
		<tr>
			<td valign="bottom">
				<div class="tabSet" id="tabSet">
					<div class="tabOff" tabId="snmpSettings" contextId="FORM_SNMP_SETTINGS" id="snmpSettings" contentLocation="../Forms/SNMPSettingsPage.xsl"><script type="text/javascript">document.write(top.getString('settings'));</script></div>
					<div class="tabOff" tabid="snmpUsers" contextId="FORM_SNMP_USERS" id="snmpUsers" contentLocation="../Forms/SNMPUsers.xsl"><script type="text/javascript">document.write(top.getString('users'));</script></div>					
					<div class="tabBottomLine"></div>
			  </div> 				
			</td>
		</tr>
		<tr>
			<td style="padding-top:10px;">
        <div id="tabContent"></div>
        <div id="waitContainer" class="waitContainer"></div>
			</td>
		</tr>
	</table>

  <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
  </script>

</body>
</html>
