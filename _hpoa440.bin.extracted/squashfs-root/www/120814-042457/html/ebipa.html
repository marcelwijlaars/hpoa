<!--	(C) Copyright 2006-2014 Hewlett-Packard Development Company, L.P.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>HP BladeSystem Onboard Administrator</title>
<link rel="stylesheet" type="text/css" href="../css/default.css">
<link rel="stylesheet" type="text/css" href="../css/blue_theme.css">
<link rel="stylesheet" type="text/css" href="../css/MxPortalEx.css">
<script type="text/javascript" src="../js/EnvironConstants.js"></script>
<script type="text/javascript" src="../js/buttonManager.js"></script>
<script type="text/javascript" src="../js/tabManager.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/formManager.js"></script>
<script type="text/javascript" src="../js/batchManager.js"></script>
<script type="text/javascript" src="../js/displayManager.js"></script>
<script type="text/javascript" src="../js/browser.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<script type="text/javascript" src="../js/xml.js"></script>
<script type="text/javascript" src="../js/xslt.js"></script>
<script type="text/javascript" src="../js/domBuilder.js"></script>
<script type="text/javascript" src="../js/ipv4.js"></script>
<script type="text/javascript" src="../js/ebipa.js"></script>

<script type="text/javascript">
var encNum;
var hpem=null;
var BLADE_EVENT_MP=0;
var BLADE_EVENT_INFO=1;
function loadContent(){
encNum=parseInt(getSearchValue(location.search,'encNum'));
if(!isNaN(encNum)&&(hpem=top.mainPage.getHiddenFrame().getProxy(encNum))!=null){
<!--Add EVENT_BLADE_FQDN_INFO_REFRESH to the handler of BLADE_MP_INFO,in case of adding FQDN to this page in the future-->
hpem.registerEventHandler(function(result){updateDeviceList(result,BLADE_EVENT_MP);},['EVENT_BLADE_MP_INFO','EVENT_ILO_HAS_IPADDRESS']);
hpem.registerEventHandler(function(result){updateDeviceList(result,BLADE_EVENT_INFO);},['EVENT_BLADE_INFO','EVENT_BAY_CHANGED']);
<!--Add EVENT_TRAY_FQDN_INFO_REFRESH to the handler of INTERCONNECT_INFO,in case of adding FQDN to this page in the future-->
hpem.registerEventHandler(updateInterconnectList,['EVENT_INTERCONNECT_INFO','EVENT_TRAY_FQDN_INFO_REFRESH']);
ourTabManager.toggleTabs('ebipaServer');
setTabContent('ebipaServer');
}
else{
displayContentFailed('tabContent',[top.getString('noOnboardAdmin')]);
}
}
function setTabContent(tabId){
var tab=document.getElementById(tabId);
if(tab){
var contentLocation=tab.getAttribute('contentLocation');
var contextId=tab.getAttribute('contextId');
if(contentLocation){
var formMgrDev=new FormManager(function(success){
var formMgr=new FormManager(function(success){
var side=0;
var ebipaInfoDoc=formMgr.getDataByCallIndex(0);
if(tabId.indexOf('ebipaServer1')>-1){
side=1;
}else if(tabId.indexOf('ebipaServer2')>-1){
side=2;
}
var processor=new XsltProcessor(contentLocation);
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('ebipaInfoDoc',ebipaInfoDoc);
processor.addParameter('serviceUserAcl',hpem.getUserAccessLevel());
processor.addParameter('side',side);
document.getElementById('tabContent').innerHTML=processor.getOutput();
if(tabId.indexOf('ebipaServer')>-1){
transformDeviceList([hpem],[side],hpem.getUserAccessLevel());
}else{
transformInterconnectList([hpem],hpem.getUserAccessLevel());
}
reconcilePage();
},false,'','tabContent');
formMgr.startBatch(true);
formMgr.queueCall(hpem.getBladeMpInfoAll);
formMgr.queueCall(hpem.getVlanInfo);
formMgr.endBatch();
top.mainPage.getHelpLauncher().setCurrentTopic(contextId);
},false,'','tabContent');
formMgrDev.startBatch(true,true);
formMgrDev.queueCall(hpem.getEbipaDevInfo);
formMgrDev.endBatch();
}
}
else{
displayContentFailed('tabContent',[top.getString('problemSelectTab')]);
}
}
function getCurrentTab(){
return ourTabManager.getCurrentTab();
}
function updateDeviceList(result,eventType){
var bayNumber=getElementValueXpath(result,'//hpoa:bayNumber');
if(isNaN(parseInt(bayNumber))){
return;
}
if(eventType==BLADE_EVENT_MP){
var mpInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'server'+bayNumber+'MpAddress');
if(mpInfoSpan){
var currentAddress=getElementValueXpath(result,'//hpoa:ipAddress');
if(currentAddress=='0.0.0.0'||currentAddress==''){
currentAddress='N/A';
}
mpInfoSpan.innerHTML=currentAddress;
}
}
else if(eventType==BLADE_EVENT_INFO){
var bladeInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'server'+bayNumber+'DeviceType');
if(bladeInfoSpan){
var deviceType=getElementValueXpath(result,'//hpoa:bladeType');
var presence=getElementValueXpath(result,'//hpoa:presence');
var deviceText='';
if(presence=='ABSENT'){
deviceText=top.getString('statusAbsent');
}else if(presence=='SUBSUMED'){
deviceText=top.getString('subsumed');
}else{
if(deviceType=='BLADE_TYPE_SERVER'){
deviceText=top.getString('serverBlade');
}
else if(deviceType=='BLADE_TYPE_STORAGE'){
deviceText=top.getString('storageBlade');
}
else if(deviceType=='BLADE_TYPE_IO'){
deviceText=top.getString('ioBlade');
}else{
deviceText=top.getString('statusUnknown');
}
}
bladeInfoSpan.innerHTML=deviceText;
}
}
}
function updateInterconnectList(result){
var bayNumber=getElementValueXpath(result,'//hpoa:bayNumber');
var mpInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'interconnect'+bayNumber+'MpAddress');
var ioInfoSpan=document.getElementById('enc'+hpem.getEnclosureNumber()+'interconnect'+bayNumber+'DeviceType');
if(ioInfoSpan){
var ioStatusDoc=hpem.getInterconnectTrayStatus(bayNumber,null,false);
var presence=getElementValueXpath(ioStatusDoc,'//hpoa:presence');
var presenceText=top.getString('statusUnknown');
if(presence=='PRESENT'){
var ioType=getElementValueXpath(result,'//hpoa:interconnectTrayType');
var extendedIoType=getElementValueXpath(result,'//hpoa:extraData[@hpoa:name="ExtendedFabricType"]');
if(extendedIoType!=""){
presenceText=extendedIoType;
}
else{
switch(ioType){
case 'INTERCONNECT_TRAY_TYPE_NIC':
presenceText='Ethernet';
break;
case 'INTERCONNECT_TRAY_TYPE_FC':
presenceText='Fiber Channel';
break;
case 'INTERCONNECT_TRAY_TYPE_SAS':
presenceText='SAS';
break;
case 'INTERCONNECT_TRAY_TYPE_IB':
presenceText='Infiniband';
break;
case 'INTERCONNECT_TRAY_TYPE_PCIE':
presenceText='PCIE';
break;
case 'INTERCONNECT_TRAY_TYPE_MAX':
presenceText='MAX';
break;
case 'INTERCONNECT_TRAY_TYPE_NO_CONNECTION':
presenceText=top.getString('noConnection');
break;
default:
presenceText=top.getString('statusUnknown');
}
}
}
else if(presence=='SUBSUMED'){
presenceText=top.getString('subsumed');
}
else if(presence=='ABSENT'){
presenceText=top.getString('statusAbsent');
}
ioInfoSpan.innerHTML=presenceText;
}
if(mpInfoSpan){
var inbandIp=getElementValueXpath(result,'//hpoa:inBandIpAddress');
mpInfoSpan.innerHTML=inbandIp;
}
}
function setupEbipa(bayType,side){
var waitPhrase=top.getString('completingEBIPASetting');
var waitDescription=top.getString('setupEbipa');
var bayPrefix='';
var errorID='';
var ebipaConfig=null;
var ebipaNetProtocol;
var confirmMsg='';
if(bayType=='SERVER_BLADE_BAY'){
bayPrefix='svb';
errorID='serverErrorDisplay';
ebipaNetProtocol=NET_PROTO_EBIPA_SVB();
waitDescription+=top.getString('setupEbipaDev');
confirmMsg=top.getString('saveEBIPASettingDesc');
confirmMsg+=top.getString('areYouSureProceed');
}
else if(bayType=='INTERCONNECT_TRAY_BAY'){
bayPrefix='swm';
errorID='interconnectErrorDisplay';
ebipaNetProtocol=NET_PROTO_EBIPA_SWM();
if(!checkRangeValidInterconnect()){
alert(top.getString('ebipaInterconnectRangeInvalid'));
return;
}
waitDescription+=top.getString('setupEbipaInt');
confirmMsg=top.getString('noteEbipaEnabledBaysAddr');
confirmMsg+=top.getString('areYouSureProceed');
}
if(confirm(confirmMsg)){
ebipaConfig=getEbipaConfig(hpem,hpem.getUuid());
var formMgr=new FormManager(function(success){
if(success){
var processor=new XsltProcessor('../Templates/ebipaErrors.xsl');
processor.addParameter('stringsDoc',top.getStringsDoc());
processor.addParameter('errorsDoc',formMgr.getDataByCallIndex(0));
var errorContainer=document.getElementById(errorID);
errorContainer.innerHTML=processor.getOutput();
errorContainer.style.display='block';
}
},false,errorID,'tabContent');
formMgr.createWaitContainer(waitPhrase,waitDescription);
formMgr.startBatch();
formMgr.queueCall(hpem.configureEbipaDev,[ebipaConfig]);
formMgr.endBatch();
}
}
function unloadHandlers(){
try{
hpem.removeRegisteredHandler(updateInterconnectList);
}
catch(e){}
}
	</script>
</head>
<body style="margin:10px;" onload="loadContent();" onunload="unloadHandlers();">
    
    <b><script type="text/javascript">document.write(top.getString('ebipaLong'));</script></b><br />
	<span class="whiteSpacer">&#160;</span><br />
    
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
      <tr>
        <td valign="bottom">
          <div class="tabSet" id="tabSet">
            <div class="tabOff" tabid="ebipaServer" contextId="FORM_SVB_EBIPA_SETTINGS" id="ebipaServer" contentLocation="../Forms/EbipaServer.xsl"><script type="text/javascript">document.write(top.getString('serverBays'));</script></div>
            <div class="tabOff" tabid="ebipaServer1" contextId="FORM_SVB_EBIPA_SIDE_A_SETTINGS" id="ebipaServer1" contentLocation="../Forms/EbipaServer.xsl"><script type="text/javascript">document.write(top.getString('serverBayDblDenseSideA'));</script></div>
            <div class="tabOff" tabid="ebipaServer2" contextId="FORM_SVB_EBIPA_SIDE_B_SETTINGS" id="ebipaServer2" contentLocation="../Forms/EbipaServer.xsl"><script type="text/javascript">document.write(top.getString('serverBayDblDenseSideB'));</script></div>
            <div class="tabOff" tabid="ebipaInterconnect" contextId="FORM_SWM_EBIPA_SETTINGS" id="ebipaInterconnect" contentLocation="../Forms/EbipaInterconnect.xsl"><script type="text/javascript">document.write(top.getString('interconnectBays'));</script></div>
            <div class="tabBottomLine"></div>
          </div>					
        </td>
      </tr>
      <tr>
        <td style="padding-top:10px;">
          <div id="tabContent"></div>
        </td>
      </tr>
    </table>

    <script type="text/javascript">
if(typeof(TabManager)!="undefined"){
ourTabManager.init();
}
    </script>

	<div id="waitContainer"></div>
</body>
</html>
